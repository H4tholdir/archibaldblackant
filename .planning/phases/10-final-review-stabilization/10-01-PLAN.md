---
phase: 10-final-review-stabilization
plan: 01
type: execute
---

<objective>
Run comprehensive automated verification suite and production health audit to find any remaining issues before sign-off.

Purpose: Confirm the PWA is fully functional after 9 phases of stabilization work, identify and fix any regressions.
Output: Complete verification report with all tests passing and production health confirmed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Recent phase summaries (directly relevant):
@.planning/phases/09-e2e-tests-vps-validation/09-04-SUMMARY.md

# VPS access:
@VPS-ACCESS-CREDENTIALS.md

# Test configs:
@archibald-web-app/frontend/playwright.vps.config.ts
@archibald-web-app/frontend/vitest.config.ts
@archibald-web-app/backend/tsconfig.json

**Constraining decisions:**
- Backend global rate limit: 500 req/60s (configurable via RATE_LIMIT_GLOBAL_MAX)
- Nginx rate limiting: 30r/s api_limit, 5r/m login_limit
- E2E test credentials: TEST_USER_USERNAME=ikiA0930 TEST_USER_PASSWORD=Fresis26@
- VPS host: formicanera.com (91.98.136.198), user: deploy

**Deferred issues:**
- ~50 unused type exports from Knip report — assess if worth addressing
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full automated verification suite</name>
  <files>N/A (execution task)</files>
  <action>
Run the complete automated verification matrix and collect results:

1. **Backend type-check:**
   `npm run build --prefix archibald-web-app/backend`

2. **Frontend type-check:**
   `npm run type-check --prefix archibald-web-app/frontend`

3. **Backend unit tests:**
   `npm test --prefix archibald-web-app/backend`

4. **Frontend unit tests:**
   `npm test --prefix archibald-web-app/frontend`

5. **E2E tests against VPS:**
   ```
   cd archibald-web-app/frontend
   TEST_USER_USERNAME="ikiA0930" TEST_USER_PASSWORD="Fresis26@" \
   npx playwright test --config=playwright.vps.config.ts
   ```

Collect all results into a verification matrix:
| Check | Status | Details |
|-------|--------|---------|
| Backend type-check | ? | |
| Frontend type-check | ? | |
| Backend unit tests | ? | X passed, Y failed |
| Frontend unit tests | ? | X passed, Y failed |
| E2E tests (VPS) | ? | X passed, Y failed |

If ANY check fails, document the failure details for Task 2.
  </action>
  <verify>All 5 checks produce results (pass or fail with details)</verify>
  <done>Complete verification matrix with all results documented</done>
</task>

<task type="auto">
  <name>Task 2: Production infrastructure health audit</name>
  <files>N/A (execution task)</files>
  <action>
SSH into VPS and audit all production infrastructure:

1. **Docker containers status:**
   `docker compose ps` — verify all containers are running and healthy

2. **Backend health endpoint:**
   `curl -s https://formicanera.com/api/health` — verify returns {"status":"ok"}

3. **PostgreSQL health:**
   `docker compose exec postgres pg_isready` — verify DB accepting connections

4. **Redis health:**
   `docker compose exec redis redis-cli ping` — verify PONG response

5. **Disk usage:**
   `df -h /` — verify sufficient disk space (warn if >80%)
   `docker system df` — check Docker disk usage

6. **Recent error logs (last 100 lines):**
   `docker compose logs --tail=100 backend 2>&1 | grep -i "error\|fatal\|crash"` — check for errors

7. **Nginx rate limiting verification:**
   `grep 'limit_req ' nginx/nginx.conf` — confirm rate limiting is enabled (not commented out)

8. **SSL certificate validity:**
   `echo | openssl s_client -connect formicanera.com:443 2>/dev/null | openssl x509 -noout -dates` — verify cert not expiring soon

Collect all results into infrastructure report:
| Component | Status | Details |
|-----------|--------|---------|
| Docker containers | ? | N running |
| Backend health | ? | |
| PostgreSQL | ? | |
| Redis | ? | |
| Disk usage | ? | X% used |
| Error logs | ? | N errors found |
| Nginx rate limiting | ? | enabled/disabled |
| SSL certificate | ? | expires YYYY-MM-DD |

If ANY issues found: fix them immediately (auto-fix bugs deviation rule).
If deferred issues (~50 unused type exports) are trivial to address: clean them up.
If deferred issues require significant work: document and leave for future.
  </action>
  <verify>All 8 infrastructure checks produce results. VPS SSH key cleaned up after audit.</verify>
  <done>Complete infrastructure report. All critical checks passing. SSH key removed from /tmp.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Backend type-check passes
- [ ] Frontend type-check passes
- [ ] Backend unit tests pass
- [ ] Frontend unit tests pass
- [ ] E2E tests pass against VPS (35/35)
- [ ] All Docker containers running on VPS
- [ ] Backend health endpoint returns OK
- [ ] PostgreSQL accepting connections
- [ ] Redis responding
- [ ] Disk usage < 80%
- [ ] No critical errors in recent logs
- [ ] Nginx rate limiting enabled
- [ ] SSL certificate valid
- [ ] Any discovered issues fixed or documented
</verification>

<success_criteria>

- All automated checks pass (type-check, unit tests, E2E)
- Production infrastructure fully healthy
- No regressions found (or all regressions fixed)
- Complete verification matrix documented
- Complete infrastructure report documented
</success_criteria>

<output>
After completion, create `.planning/phases/10-final-review-stabilization/10-01-SUMMARY.md`
</output>
