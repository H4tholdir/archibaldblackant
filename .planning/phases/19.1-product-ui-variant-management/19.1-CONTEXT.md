# Phase 19.1: Product Cards UI Enhancement - Context

## Overview

Aggiornare le schede articolo per visualizzare tutti i 26+ nuovi campi estratti dal PDF (Phase 19-01) e implementare la gestione delle varianti per unificare articoli "doppioni" che differiscono solo per contenuto imballaggio.

## Problem Statement

**Situazione attuale:**
- Le schede articolo mostrano solo i campi base (nome, descrizione, gruppo, prezzo)
- Non vengono visualizzati i 26+ nuovi campi estratti dal PDF in Phase 19-01
- Articoli con stesso ID ma diverso `packageContent` appaiono come schede separate (doppioni)
- Gli utenti non vedono informazioni complete come: Figura, Grandezza, Quantit√† Standard, Sconti, ecc.

**Esempio problema doppioni:**
```
Articolo: 354TL.12.000.050
- Variante 1: packageContent = "5 colli"  ‚Üí Scheda separata
- Variante 2: packageContent = "1 collo"  ‚Üí Scheda separata

Risultato: 2 schede identiche che confondono l'utente
```

**Obiettivo:**
1. Visualizzare tutti i 26+ campi nelle schede articolo
2. Unificare articoli con stesso ID base in un'unica scheda
3. Gestire le varianti (contenuto imballaggio) come opzioni selezionabili
4. Mantenere compatibilit√† con il flusso ordini esistente

## User Requirements

### 1. Visualizzazione Campi Completi

**Campi da mostrare nelle schede articolo:**

**Sezione Identificazione:**
- ID Articolo (gi√† presente)
- Nome Articolo (gi√† presente)
- Descrizione (gi√† presente)
- Nome Ricerca
- Visualizza Numero Prodotto

**Sezione Caratteristiche:**
- **Figura** ‚≠ê (nuovo)
- **Contenuto Imballaggio** ‚≠ê (nuovo - gestito come variante)
- **Grandezza** ‚≠ê (nuovo)
- Gruppo Articolo (gi√† presente)
- Descrizione Gruppo Articolo
- ID Gruppo Prodotti
- ID Prodotto

**Sezione Quantit√†:**
- **Quantit√† Minima** (gi√† usata in OrderForm)
- **Quantit√† in Multipli** (gi√† usata in OrderForm)
- **Quantit√† Massima** (gi√† usata in OrderForm)
- **Quantit√† Standard** ‚≠ê (nuovo)
- **Quantit√† Predefinita** ‚≠ê (nuovo)

**Sezione Pricing & Sconti:**
- Prezzo (gi√† presente - viene da Excel listino)
- IVA (gi√† presente - viene da Excel listino)
- Unit√† Prezzo
- **Sconto Linea** ‚≠ê (nuovo)
- **Sconto Assoluto Totale** ‚≠ê (nuovo)
- Purch Price

**Sezione Metadati:**
- ID Configurazione
- PCS ID Configurazione Standard
- ID Blocco Articolo
- Pacco Gamba
- Data Creata / Creato Da
- Datetime Modificato / Modificato Da
- DataAreaId
- Articolo Ordinabile
- Fermato (Stopped)
- ID Unit√†

### 2. Gestione Varianti (Contenuto Imballaggio)

**Requisiti:**
- Articoli con stesso `id` (es. "354TL.12.000.050") ma diverso `packageContent` ‚Üí **1 sola scheda**
- Contenuto imballaggio mostrato come **varianti selezionabili** (simile a Phase 3 per OrderForm)
- Selezione variante aggiorna automaticamente: `minQty`, `multipleQty`, `maxQty`, `standardQty`
- Ogni variante ha il suo prezzo (dalla fase sync prezzi - Phase 20)

**Esempio UI desiderato:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 354TL.12.000.050 - Guarnizione XYZ      ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ Contenuto Imballaggio:                  ‚îÇ
‚îÇ ‚óã 5 colli (min: 5, multipli: 5)        ‚îÇ
‚îÇ ‚óè 1 collo  (min: 1, multipli: 1)       ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ Prezzo: ‚Ç¨24.50  IVA: 22%                ‚îÇ
‚îÇ Figura: A123  Grandezza: M              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. Matching Prezzi & IVA

**‚ö†Ô∏è IMPORTANTE:** Prezzi e IVA vengono da Excel listino (gi√† implementato in Phase 4.1-02)

**Flusso attuale (da mantenere):**
1. Phase 19 ‚Üí Sync articoli da PDF (campi base + metadati)
2. Phase 20 ‚Üí Sync prezzi da Excel listino ‚Üí popola `price`, `priceSource`, `vat`, `vatSource`
3. Phase 19.1 (questa fase) ‚Üí Visualizza `price` e `vat` nelle schede (gi√† presenti nel DB)

**NON fare in questa fase:**
- ‚ùå Matching prezzi da Excel (gi√† fatto)
- ‚ùå Calcolo IVA (gi√† fatto)
- ‚ùå Import Excel listino (gi√† implementato)

**Fare in questa fase:**
- ‚úÖ Mostrare `price` e `vat` che gi√† esistono nel DB
- ‚úÖ Placeholder se `price === null` ‚Üí "Prezzo non disponibile"
- ‚úÖ Badge se `priceSource === 'default'` ‚Üí "‚ö†Ô∏è Prezzo stimato"

## Technical Approach

### 1. Database Layer

**Nessuna modifica al DB** - Tutti i campi gi√† presenti dopo Phase 19-01.

**Query per varianti:**
```typescript
// ProductDatabase.ts
getProductVariants(baseId: string): Product[] {
  return this.db.prepare(`
    SELECT * FROM products
    WHERE id LIKE ? || '%'
    ORDER BY packageContent DESC
  `).all(baseId);
}
```

### 2. Frontend Components

**Nuovi componenti:**

1. **ProductCard.tsx** (refactor esistente)
   - Mostra tutti i 26+ campi
   - Layout responsive (mobile-first)
   - Sezioni collapsabili per campi avanzati

2. **VariantSelector.tsx** (nuovo)
   - Radio buttons per varianti (packageContent)
   - Mostra regole quantit√† per ogni variante
   - Aggiorna prezzo in base a variante selezionata

3. **ProductDetailModal.tsx** (nuovo)
   - Modal con tutti i dettagli prodotto
   - Tab per sezioni (Caratteristiche, Quantit√†, Pricing, Metadati)
   - Aperto da click su ProductCard

### 3. API Endpoints

**Nuovi endpoint:**

```typescript
// GET /api/products/:id/variants
// Ritorna tutte le varianti di un prodotto base
app.get('/api/products/:id/variants', jwtMiddleware, (req, res) => {
  const variants = db.getProductVariants(req.params.id);
  res.json({ variants });
});
```

### 4. Pagina Articoli

**Modifiche a Articoli.tsx:**
- Mostra 1 scheda per articolo base (non 1 per variante)
- Badge con numero varianti (es. "3 confezioni")
- Click apre ProductDetailModal con VariantSelector

## Out of Scope

**NON fare in questa fase:**
- ‚ùå Sync prezzi da Excel (Phase 20)
- ‚ùå Calcolo prezzi default (gi√† fatto Phase 4.1-02)
- ‚ùå Modifica schema database (gi√† fatto Phase 19-01)
- ‚ùå Background sync (Phase 19-04)
- ‚ùå Testing performance parser (Phase 19-05)

## Dependencies

**Dipende da:**
- Phase 19-01 ‚úÖ (schema DB con 26+ campi)
- Phase 19-02 ‚úÖ (sync articoli funzionante)
- Phase 4.1-02 ‚úÖ (matching prezzi da Excel gi√† implementato)

**Richiesto per:**
- Phase 20 (Prices Sync) - pu√≤ procedere in parallelo
- User experience completa per agenti

## Success Criteria

- [ ] Schede articolo mostrano tutti i 26+ campi
- [ ] Articoli con stesso ID base unificati in 1 scheda
- [ ] VariantSelector funzionante (packageContent)
- [ ] ProductDetailModal con layout completo
- [ ] Badge "Prezzo stimato" per prezzi default
- [ ] Placeholder "Prezzo non disponibile" se price === null
- [ ] Mobile-responsive
- [ ] Nessuna regressione su OrderForm esistente

## Estimated Duration

**3-4 plans, ~3 hours total**

## Next Steps

Dopo approvazione di questo context:
1. Creare breakdown dettagliato dei plans
2. Pianificare task per ogni plan
3. Eseguire in sequenza

---

**Status:** üìã Draft - Awaiting user approval
