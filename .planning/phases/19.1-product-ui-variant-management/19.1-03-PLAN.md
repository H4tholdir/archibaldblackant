# Phase 19.1 Plan 03: Variant Selector & ArticoliList Deduplication

<objective>
Create VariantSelector component for package selection UI, update ArticoliList to display grouped products (one card per article), and integrate variant selection with ProductCard modal display.
</objective>

<execution_context>
@archibald-web-app/frontend/src/components/ProductCard.tsx
@archibald-web-app/frontend/src/pages/ArticoliList.tsx
@archibald-web-app/frontend/src/api/products.ts
@.planning/phases/19.1-product-ui-variant-management/19.1-CONTEXT.md
@.planning/phases/19.1-product-ui-variant-management/19.1-01-PLAN.md
@.planning/codebase/CONVENTIONS.md
</execution_context>

<context>
**Current State:**
- ArticoliList displays ALL variants as separate cards
- ProductCard expanded view shows single variant's details
- No variant selection UI exists
- Phase 19.1-01 provides: getProductVariants() API, grouped=true mode

**From Phase 19.1 Context:**
- Variants have same article name, different `id` and `packageContent`
- Example: "GUARNIZIONE CANALETTA" â†’ 2 variants ("5 colli", "1 collo")
- Each variant has different minQty, multipleQty, maxQty
- Prices differ per variant (from database)

**UI Requirements:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 354TL.12.000.050 - Guarnizione XYZ      â”‚
â”‚                                         â”‚
â”‚ Contenuto Imballaggio:                  â”‚
â”‚ â—‹ 5 colli (min: 5, multipli: 5)        â”‚
â”‚ â— 1 collo  (min: 1, multipli: 1)       â”‚
â”‚                                         â”‚
â”‚ Prezzo: â‚¬24.50  IVA: 22%                â”‚
â”‚ Figura: A123  Grandezza: M              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Phase 3 Pattern (from 03-01-SUMMARY.md):**
- OrderForm implements package selection logic
- Radio buttons for variant selection
- Shows quantity rules per variant
- Clean, mobile-friendly UI

**Design System:**
- Radio buttons: Native HTML styled with inline CSS
- Selected state: blue (#1976d2) background
- Hover effects: subtle background change
- Mobile-responsive (min 375px width)

**Tech Stack:**
- React 19 functional components
- Inline styles (no CSS modules)
- Type-safe with TypeScript
</context>

<tasks>

## Task 1: Create VariantSelector component

**File:** `archibald-web-app/frontend/src/components/VariantSelector.tsx` (NEW)

Create reusable variant selector component:

```typescript
import type { Product } from "../api/products";

interface VariantSelectorProps {
  variants: Product[];
  selectedVariantId: string;
  onVariantChange: (variantId: string) => void;
}

export function VariantSelector({
  variants,
  selectedVariantId,
  onVariantChange,
}: VariantSelectorProps) {
  if (variants.length <= 1) {
    // No need for selector if only one variant
    return null;
  }

  // Sort variants by numeric value in packageContent (descending)
  const sortedVariants = [...variants].sort((a, b) => {
    const extractNumber = (pkg: string | undefined): number => {
      if (!pkg) return 0;
      const match = pkg.match(/(\d+)/);
      return match ? parseInt(match[1], 10) : 0;
    };
    return extractNumber(b.packageContent) - extractNumber(a.packageContent);
  });

  const formatCurrency = (amount: number | null | undefined): string => {
    if (amount === null || amount === undefined || amount === 0)
      return "â‚¬ 0,00";
    return new Intl.NumberFormat("it-IT", {
      style: "currency",
      currency: "EUR",
    }).format(amount);
  };

  return (
    <div style={{ marginBottom: "20px" }}>
      <h3
        style={{
          fontSize: "16px",
          fontWeight: 700,
          color: "#333",
          marginBottom: "12px",
        }}
      >
        ğŸ“¦ Seleziona Confezione
      </h3>
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          gap: "12px",
        }}
      >
        {sortedVariants.map((variant) => {
          const isSelected = variant.id === selectedVariantId;
          return (
            <label
              key={variant.id}
              style={{
                display: "flex",
                alignItems: "flex-start",
                padding: "16px",
                borderRadius: "8px",
                border: isSelected
                  ? "2px solid #1976d2"
                  : "2px solid #e0e0e0",
                backgroundColor: isSelected ? "#e3f2fd" : "#fff",
                cursor: "pointer",
                transition: "all 0.2s",
              }}
              onMouseEnter={(e) => {
                if (!isSelected) {
                  e.currentTarget.style.backgroundColor = "#f5f5f5";
                  e.currentTarget.style.borderColor = "#bdbdbd";
                }
              }}
              onMouseLeave={(e) => {
                if (!isSelected) {
                  e.currentTarget.style.backgroundColor = "#fff";
                  e.currentTarget.style.borderColor = "#e0e0e0";
                }
              }}
            >
              {/* Radio button */}
              <input
                type="radio"
                name="variant-selector"
                value={variant.id}
                checked={isSelected}
                onChange={() => onVariantChange(variant.id)}
                style={{
                  marginRight: "12px",
                  marginTop: "4px",
                  width: "18px",
                  height: "18px",
                  cursor: "pointer",
                  accentColor: "#1976d2",
                }}
              />

              {/* Variant details */}
              <div style={{ flex: 1 }}>
                <div
                  style={{
                    fontSize: "15px",
                    fontWeight: 600,
                    color: isSelected ? "#1976d2" : "#333",
                    marginBottom: "6px",
                  }}
                >
                  {variant.packageContent || "Standard"}
                </div>

                <div
                  style={{
                    fontSize: "13px",
                    color: "#666",
                    marginBottom: "8px",
                  }}
                >
                  <strong>Codice:</strong> {variant.id}
                </div>

                {/* Quantity rules */}
                <div
                  style={{
                    display: "flex",
                    gap: "16px",
                    flexWrap: "wrap",
                    fontSize: "13px",
                    color: "#666",
                  }}
                >
                  {variant.minQty !== undefined && variant.minQty !== null && (
                    <span>
                      <strong>Min:</strong> {variant.minQty}
                    </span>
                  )}
                  {variant.multipleQty !== undefined &&
                    variant.multipleQty !== null && (
                      <span>
                        <strong>Multipli:</strong> {variant.multipleQty}
                      </span>
                    )}
                  {variant.maxQty !== undefined && variant.maxQty !== null && (
                    <span>
                      <strong>Max:</strong> {variant.maxQty}
                    </span>
                  )}
                </div>

                {/* Price (if available) */}
                {variant.price !== undefined && variant.price !== null && (
                  <div
                    style={{
                      marginTop: "8px",
                      fontSize: "14px",
                      fontWeight: 600,
                      color: isSelected ? "#1976d2" : "#333",
                    }}
                  >
                    {formatCurrency(variant.price)}
                    {variant.vat !== undefined && variant.vat !== null && (
                      <span
                        style={{
                          marginLeft: "8px",
                          fontSize: "12px",
                          fontWeight: 400,
                          color: "#666",
                        }}
                      >
                        (IVA {variant.vat}%)
                      </span>
                    )}
                  </div>
                )}
              </div>
            </label>
          );
        })}
      </div>

      {/* Helper text */}
      <div
        style={{
          marginTop: "12px",
          fontSize: "12px",
          color: "#999",
          fontStyle: "italic",
        }}
      >
        ğŸ’¡ Seleziona la confezione appropriata in base alla quantitÃ  desiderata
      </div>
    </div>
  );
}
```

**Rationale:**
- Radio buttons for mutually exclusive selection
- Sorts variants by package size (largest first)
- Shows quantity rules (min, multipli, max) for each variant
- Displays price/VAT if available
- Selected state highlighted (blue border + background)
- Hover effects for better UX
- Mobile-responsive (stacks vertically)
- Helper text guides user selection

## Task 2: Create ProductDetailModal component

**File:** `archibald-web-app/frontend/src/components/ProductDetailModal.tsx` (NEW)

Create modal to display product details with variant selector:

```typescript
import { useState, useEffect } from "react";
import { ProductCard } from "./ProductCard";
import { VariantSelector } from "./VariantSelector";
import { getProductVariants, type Product } from "../api/products";

interface ProductDetailModalProps {
  product: Product;
  isOpen: boolean;
  onClose: () => void;
}

export function ProductDetailModal({
  product,
  isOpen,
  onClose,
}: ProductDetailModalProps) {
  const [variants, setVariants] = useState<Product[]>([product]);
  const [selectedVariantId, setSelectedVariantId] = useState(product.id);
  const [loadingVariants, setLoadingVariants] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Fetch variants when modal opens
  useEffect(() => {
    if (!isOpen) return;

    const fetchVariants = async () => {
      setLoadingVariants(true);
      setError(null);

      try {
        const token = localStorage.getItem("archibald_jwt");
        if (!token) {
          throw new Error("Non autenticato");
        }

        const response = await getProductVariants(token, product.name);
        if (response.success) {
          setVariants(response.data.variants);
          // Keep current product as selected if it exists in variants
          const currentExists = response.data.variants.some(
            (v) => v.id === product.id
          );
          if (!currentExists && response.data.variants.length > 0) {
            // Default to first variant if current not found
            setSelectedVariantId(response.data.variants[0].id);
          }
        }
      } catch (err) {
        console.error("Error fetching variants:", err);
        setError(
          err instanceof Error
            ? err.message
            : "Errore nel caricamento delle varianti"
        );
        // Keep single product as fallback
        setVariants([product]);
      } finally {
        setLoadingVariants(false);
      }
    };

    fetchVariants();
  }, [isOpen, product]);

  // Get currently selected variant
  const selectedVariant =
    variants.find((v) => v.id === selectedVariantId) || variants[0] || product;

  if (!isOpen) return null;

  return (
    <>
      {/* Modal Overlay */}
      <div
        style={{
          position: "fixed",
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: "rgba(0, 0, 0, 0.5)",
          zIndex: 1000,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          padding: "20px",
          overflowY: "auto",
        }}
        onClick={onClose}
      >
        {/* Modal Content */}
        <div
          style={{
            backgroundColor: "#fff",
            borderRadius: "12px",
            maxWidth: "900px",
            width: "100%",
            maxHeight: "90vh",
            overflowY: "auto",
            position: "relative",
          }}
          onClick={(e) => e.stopPropagation()} // Prevent close on content click
        >
          {/* Close Button */}
          <button
            onClick={onClose}
            style={{
              position: "sticky",
              top: "16px",
              right: "16px",
              float: "right",
              width: "40px",
              height: "40px",
              borderRadius: "50%",
              border: "none",
              backgroundColor: "#f5f5f5",
              color: "#666",
              fontSize: "24px",
              cursor: "pointer",
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              zIndex: 10,
              transition: "background-color 0.2s",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.backgroundColor = "#e0e0e0";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.backgroundColor = "#f5f5f5";
            }}
            aria-label="Chiudi"
          >
            Ã—
          </button>

          {/* Modal Body */}
          <div style={{ padding: "24px", clear: "both" }}>
            <h2
              style={{
                fontSize: "24px",
                fontWeight: 700,
                color: "#333",
                marginBottom: "20px",
              }}
            >
              {product.name}
            </h2>

            {/* Error Message */}
            {error && (
              <div
                style={{
                  padding: "12px",
                  backgroundColor: "#ffebee",
                  color: "#c62828",
                  borderRadius: "8px",
                  marginBottom: "20px",
                  fontSize: "14px",
                }}
              >
                âš ï¸ {error}
              </div>
            )}

            {/* Loading State */}
            {loadingVariants && (
              <div
                style={{
                  padding: "20px",
                  textAlign: "center",
                  color: "#999",
                }}
              >
                <div
                  style={{
                    fontSize: "16px",
                    marginBottom: "12px",
                  }}
                >
                  Caricamento varianti...
                </div>
              </div>
            )}

            {/* Variant Selector */}
            {!loadingVariants && variants.length > 1 && (
              <VariantSelector
                variants={variants}
                selectedVariantId={selectedVariantId}
                onVariantChange={setSelectedVariantId}
              />
            )}

            {/* Product Card (always expanded) */}
            {!loadingVariants && (
              <ProductCard
                product={selectedVariant}
                expanded={true}
                onToggle={() => {}} // No-op since always expanded in modal
                showVariantBadge={false} // Don't show badge in modal
              />
            )}
          </div>
        </div>
      </div>
    </>
  );
}
```

**Rationale:**
- Full-screen modal with backdrop
- Fetches variants on open (lazy loading)
- Variant selector at top, product details below
- Always shows expanded product card
- Close button (sticky, always visible)
- Click outside to close
- Error handling with user-friendly messages
- Loading state while fetching variants
- Responsive (scrollable on small screens)

## Task 3: Update ArticoliList to use grouped mode

**File:** `archibald-web-app/frontend/src/pages/ArticoliList.tsx`

Update ArticoliList to display one card per product (grouped mode) with modal:

```typescript
import { useState, useEffect, useCallback } from "react";
import { ProductCard } from "../components/ProductCard";
import { ProductDetailModal } from "../components/ProductDetailModal";
import { getProducts, type Product } from "../api/products";
import { ManualSyncBanner } from "../components/ManualSyncBanner";

// ... keep existing interfaces ...

export function ArticoliList() {
  // ... keep existing state ...

  // NEW: Modal state
  const [modalProduct, setModalProduct] = useState<Product | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  // NEW: Variant counts map (productName -> count)
  const [variantCounts, setVariantCounts] = useState<Record<string, number>>({});

  // Update fetchProducts to use grouped mode
  const fetchProducts = useCallback(async () => {
    setLoading(true);
    setError(null);

    try {
      const token = localStorage.getItem("archibald_jwt");
      if (!token) {
        setError("Non autenticato. Effettua il login.");
        setLoading(false);
        return;
      }

      // NEW: Use grouped mode
      const response = await getProducts(
        token,
        debouncedSearch,
        200,
        true // grouped=true
      );

      if (!response.success) {
        throw new Error("Errore nel caricamento dei prodotti");
      }

      // Filter by groupCode if needed (client-side filtering)
      let filteredProducts = response.data.products;
      if (filters.groupCode) {
        filteredProducts = filteredProducts.filter(
          (p) => p.groupCode === filters.groupCode
        );
      }

      setProducts(filteredProducts);
      setTotalCount(response.data.totalCount);
      setReturnedCount(response.data.returnedCount);
      setLimited(response.data.limited);

      // NEW: Fetch variant counts for all products
      // Note: This is a simplified approach. For production, consider:
      // - Backend endpoint that returns counts with products
      // - Caching variant counts
      // For now, we'll infer from product name duplicates in full list
      // Since we're in grouped mode, assume all have at least 1 variant
      // Real counts would come from separate API calls or backend enhancement
    } catch (err) {
      console.error("Error fetching products:", err);
      if (err instanceof Error && err.message.includes("401")) {
        setError("Sessione scaduta. Effettua il login.");
        localStorage.removeItem("archibald_jwt");
      } else {
        setError(
          err instanceof Error ? err.message : "Errore di rete. Riprova."
        );
      }
    } finally {
      setLoading(false);
    }
  }, [debouncedSearch, filters.groupCode]);

  // ... keep existing useEffect ...

  // NEW: Handle card click - open modal instead of expand
  const handleCardClick = (product: Product) => {
    setModalProduct(product);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
    setModalProduct(null);
  };

  // Update handleToggle to use modal
  const handleToggle = (productId: string) => {
    const product = products.find((p) => p.id === productId);
    if (product) {
      handleCardClick(product);
    }
  };

  // ... keep existing handlers (handleClearFilters, handleManualSync) ...

  return (
    <div
      style={{
        maxWidth: "1200px",
        margin: "0 auto",
        padding: "20px",
      }}
    >
      {/* ... keep existing header, filters, sync banner ... */}

      {/* Products Grid */}
      {!loading && !error && (
        <div
          style={{
            display: "grid",
            gridTemplateColumns: "repeat(auto-fill, minmax(350px, 1fr))",
            gap: "20px",
            marginTop: "20px",
          }}
        >
          {products.map((product) => (
            <ProductCard
              key={product.id}
              product={product}
              expanded={false} // Never expand in list (use modal instead)
              onToggle={() => handleCardClick(product)}
              showVariantBadge={true} // NEW: Show variant badges
              variantCount={variantCounts[product.name] || 1}
            />
          ))}
        </div>
      )}

      {/* Empty State */}
      {!loading && !error && products.length === 0 && (
        <div
          style={{
            textAlign: "center",
            padding: "60px 20px",
            color: "#999",
          }}
        >
          <div style={{ fontSize: "48px", marginBottom: "16px" }}>ğŸ“¦</div>
          <div style={{ fontSize: "18px", marginBottom: "8px" }}>
            Nessun articolo trovato
          </div>
          {hasActiveFilters && (
            <div style={{ fontSize: "14px" }}>
              Prova a modificare i filtri di ricerca
            </div>
          )}
        </div>
      )}

      {/* Loading State */}
      {loading && (
        <div
          style={{
            textAlign: "center",
            padding: "60px 20px",
            color: "#999",
          }}
        >
          <div style={{ fontSize: "18px" }}>Caricamento articoli...</div>
        </div>
      )}

      {/* Error State */}
      {error && (
        <div
          style={{
            padding: "20px",
            backgroundColor: "#ffebee",
            color: "#c62828",
            borderRadius: "8px",
            marginTop: "20px",
          }}
        >
          <strong>Errore:</strong> {error}
        </div>
      )}

      {/* Product Detail Modal */}
      {modalProduct && (
        <ProductDetailModal
          product={modalProduct}
          isOpen={isModalOpen}
          onClose={handleCloseModal}
        />
      )}
    </div>
  );
}
```

**Rationale:**
- Switched to `grouped=true` mode (one product per article)
- Click on card opens modal (instead of inline expand)
- Modal shows full details + variant selector
- Variant badges show in list view ("3 confezioni")
- Grid layout unchanged (works with grouped products)
- Existing filters, sync, error handling preserved

## Task 4: Add keyboard navigation to modal

**File:** `archibald-web-app/frontend/src/components/ProductDetailModal.tsx`

Add Escape key to close modal (accessibility):

```typescript
// Add to ProductDetailModal useEffect
useEffect(() => {
  if (!isOpen) return;

  const handleEscape = (e: KeyboardEvent) => {
    if (e.key === "Escape") {
      onClose();
    }
  };

  document.addEventListener("keydown", handleEscape);
  // Prevent body scroll when modal open
  document.body.style.overflow = "hidden";

  return () => {
    document.removeEventListener("keydown", handleEscape);
    document.body.style.overflow = "";
  };
}, [isOpen, onClose]);
```

**Rationale:**
- Escape key closes modal (standard UX pattern)
- Prevents body scroll when modal open
- Cleanup on unmount

</tasks>

<verification>

## Manual Testing Checklist

### 1. ArticoliList Grouped Mode

**Test product deduplication:**
- Navigate to /articoli page
- Verify: Each article name appears only ONCE (even if multiple variants exist)
- Verify: Product count reduced compared to old view
- Example: "GUARNIZIONE CANALETTA" shows 1 card (not 2)

**Test variant badge:**
- Find product with multiple variants
- Verify: Badge shows "2 confezioni" (or correct count)
- Verify: Badge blue background, inline with product name
- Find product with single variant
- Verify: No badge appears

### 2. ProductDetailModal

**Test modal opening:**
- Click on any product card
- Verify: Modal opens with backdrop
- Verify: Body scroll disabled
- Verify: Modal content scrollable if tall

**Test modal closing:**
- Method 1: Click âœ• button â†’ Modal closes
- Method 2: Press Escape key â†’ Modal closes
- Method 3: Click backdrop (outside modal) â†’ Modal closes
- Method 4: Click inside modal content â†’ Modal stays open

**Test variant loading:**
- Open product with 1 variant:
  - Verify: No variant selector appears
  - Verify: Product details show immediately
- Open product with 2+ variants:
  - Verify: Loading state appears briefly
  - Verify: Variant selector appears after load
  - Verify: All variants listed (sorted by package size)

### 3. VariantSelector Component

**Test variant selection:**
- Open product with 3 variants
- Verify: Variants sorted by package size (largest first)
- Example: "5 colli" before "1 collo"
- Click different variant radio button
- Verify: Selection changes (blue highlight)
- Verify: Product card below updates to show selected variant

**Test variant display:**
- Each variant shows:
  - âœ“ Package content (e.g., "5 colli")
  - âœ“ Codice (variant ID)
  - âœ“ Min, Multipli, Max (if available)
  - âœ“ Price + IVA (if available)
- Selected variant:
  - âœ“ Blue border (#1976d2)
  - âœ“ Blue background (#e3f2fd)
  - âœ“ Blue text for package name

**Test hover effects:**
- Hover over unselected variant
- Verify: Background changes to #f5f5f5
- Verify: Border changes to #bdbdbd
- Hover over selected variant
- Verify: No hover effect (stays blue)

### 4. Integration Testing

**Test modal + variant + product card integration:**
1. Open modal for product with 3 variants
2. Select variant "5 colli"
3. Verify: ProductCard shows "5 colli" data (price, minQty, etc.)
4. Select variant "1 collo"
5. Verify: ProductCard updates to show "1 collo" data
6. Close modal
7. Verify: ArticoliList unchanged (still shows grouped products)

### 5. Mobile Responsiveness

**Test on mobile (375px width):**
- ArticoliList:
  - âœ“ Grid switches to single column
  - âœ“ Cards stack vertically
  - âœ“ Variant badges visible
- Modal:
  - âœ“ Modal fills screen (with padding)
  - âœ“ Close button accessible
  - âœ“ Variant selector stacks vertically
  - âœ“ Product card sections readable
  - âœ“ Modal scrollable if content tall

### 6. Edge Cases

**Test product with no variants:**
- Open product with single variant
- Verify: No variant selector appears
- Verify: Product card shows normally
- Verify: No errors in console

**Test product with missing data:**
- Open product with:
  - No price â†’ Verify "â‚¬ 0,00" + "Prezzo non disponibile" badge
  - No quantity rules â†’ Verify variant selector shows only package content
  - No image â†’ Verify placeholder appears

**Test variant API error:**
- Simulate API error (disconnect network)
- Open product modal
- Verify: Error message appears: "âš ï¸ Errore nel caricamento delle varianti"
- Verify: Fallback to single product (no crash)

### 7. Performance

**Test with 100+ products:**
- Load ArticoliList with search returning 100+ products
- Verify: Scroll performance smooth
- Open modal for 5 different products
- Verify: Modals load quickly (<1s)
- Check DevTools Network tab
- Verify: Variant API calls cached appropriately

**Test modal memory leaks:**
1. Open modal â†’ Close modal (repeat 10 times)
2. Check DevTools Memory tab
3. Verify: No significant memory growth

### 8. Backwards Compatibility

**Test existing functionality:**
- âœ“ Product search filters work
- âœ“ Manual sync button works
- âœ“ OrderForm autocomplete unchanged
- âœ“ No console errors
- âœ“ No TypeScript errors

### 9. Accessibility

**Test keyboard navigation:**
- Tab to product card â†’ Press Enter â†’ Modal opens
- Tab to close button â†’ Press Enter â†’ Modal closes
- Press Escape â†’ Modal closes
- Tab through variant radio buttons â†’ Space to select

**Test screen reader (optional):**
- Radio buttons have proper labels
- Close button has aria-label="Chiudi"
- Modal has proper focus trap

</verification>

<success_criteria>
- [ ] VariantSelector component created with radio button UI
- [ ] ProductDetailModal component created with variant selector integration
- [ ] ArticoliList updated to use grouped=true mode
- [ ] Modal opens on product card click
- [ ] Modal closes via âœ• button, Escape key, backdrop click
- [ ] Variant selection updates displayed product details
- [ ] Variant badges show in ArticoliList ("X confezioni")
- [ ] Keyboard navigation works (Escape, Tab, Enter, Space)
- [ ] Mobile-responsive (375px+ width)
- [ ] No TypeScript compilation errors
- [ ] No console errors in browser
- [ ] Manual testing checklist completed
- [ ] Existing OrderForm functionality unaffected
</success_criteria>

<output>
**Deliverables:**
1. New component: `archibald-web-app/frontend/src/components/VariantSelector.tsx`
2. New component: `archibald-web-app/frontend/src/components/ProductDetailModal.tsx`
3. Updated: `archibald-web-app/frontend/src/pages/ArticoliList.tsx` (grouped mode + modal)
4. Keyboard navigation (Escape key) and accessibility features
5. Manual testing completed and documented

**Phase 19.1 Complete!**

All 3 plans delivered:
- âœ… Plan 19.1-01: Backend variant grouping API
- âœ… Plan 19.1-02: ProductCard enhancement (26+ fields)
- âœ… Plan 19.1-03: VariantSelector + ArticoliList deduplication

**Next Phase:**
- Phase 20: Prices Sync Analysis & Optimization
</output>
