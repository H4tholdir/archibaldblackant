---
phase: 16-target-wizard-setup
plan: 03
type: execute
---

<objective>
Create profile page with target edit section for recurring target modifications.

Purpose: Allow agents to modify monthly target without re-running wizard, providing self-service target management from user profile.
Output: ProfilePage component with target edit form + /profile route with navigation link.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-target-wizard-setup/16-01-SUMMARY.md
@.planning/phases/16-target-wizard-setup/16-02-SUMMARY.md
@.planning/phases/15-dashboard-homepage-ui/15-01-SUMMARY.md

**Key files:**
@archibald-web-app/frontend/src/components/DashboardNav.tsx
@archibald-web-app/frontend/src/AppRouter.tsx
@archibald-web-app/frontend/src/components/TargetWizard.tsx

**Tech stack available:**
- React 19 with hooks
- react-router-dom (useNavigate, Route)
- TypeScript strict mode
- Inline styles (Phase 10-06 decision)
- fetch API for backend communication

**Established patterns:**
- Phase 15-01: DashboardNav with 8 navigation links
- Phase 15-01: AppRouter.tsx with Route definitions
- Phase 16-02: Target form with currency dropdown, number input, validation
- Inline styles with consistent color palette (blue #3498db primary actions)

**Constraining decisions:**
- Profile page is authenticated route (requires JWT)
- Target editor reuses validation from TargetWizard (positive number, valid currency)
- Success feedback via toast notification (consistent with Phase 09-01 pattern)
- Navigation link added to DashboardNav between "Dashboard" and "Ordini"

**Current navigation structure:**
- DashboardNav has 8 links: Dashboard, Ordini, Storico, Bozze, Pending, Clienti, Articoli, Admin
- AppRouter has routes: /, /orders, /history, /drafts, /pending, /customers, /admin, /articoli
- Need to add: /profile route + "Profilo" link
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfilePage component with target edit section</name>
  <files>
    archibald-web-app/frontend/src/pages/ProfilePage.tsx
  </files>
  <action>
    Create ProfilePage.tsx with user info display and target edit form:

    **Component structure:**

    **Section 1: User Info (read-only)**
    - Title: "Profilo Utente"
    - Display: fullName, username (from App context or localStorage)
    - Icon: User avatar placeholder (üë§)
    - Styling: Card with light gray background

    **Section 2: Target Editor (editable)**
    - Title: "Obiettivo Mensile"
    - Form fields:
      - Currency dropdown: EUR, USD, GBP (current value pre-selected)
      - Target input: number input with current value
    - Current target display: "Obiettivo attuale: ‚Ç¨10,000" (formatted)
    - Last updated: "Ultimo aggiornamento: 18/01/2026"
    - Buttons:
      - "Salva Modifiche" (primary blue button, disabled if no changes)
      - "Annulla" (secondary gray button, resets form)
    - Success toast: "Obiettivo aggiornato con successo! ‚úì" (5s auto-hide)
    - Error toast: "Errore nel salvare l'obiettivo. Riprova." (5s auto-hide)

    **State management:**
    ```typescript
    const [currentTarget, setCurrentTarget] = useState<number>(0);
    const [currentCurrency, setCurrentCurrency] = useState<string>('EUR');
    const [editTarget, setEditTarget] = useState<number>(0);
    const [editCurrency, setEditCurrency] = useState<string>('EUR');
    const [loading, setLoading] = useState(true);
    const [saving, setSaving] = useState(false);
    const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);
    ```

    **Load current target on mount:**
    ```typescript
    useEffect(() => {
      const fetchTarget = async () => {
        const token = localStorage.getItem('archibald_jwt');
        if (!token) return;

        try {
          const response = await fetch('http://localhost:3000/api/users/me/target', {
            headers: { 'Authorization': `Bearer ${token}` }
          });

          if (response.ok) {
            const data = await response.json();
            setCurrentTarget(data.monthlyTarget);
            setCurrentCurrency(data.currency);
            setEditTarget(data.monthlyTarget);
            setEditCurrency(data.currency);
          }
        } catch (error) {
          console.error('[ProfilePage] Failed to load target:', error);
        } finally {
          setLoading(false);
        }
      };

      fetchTarget();
    }, []);
    ```

    **Save target handler:**
    ```typescript
    const handleSave = async () => {
      if (editTarget <= 0) {
        setToast({ message: 'L\'obiettivo deve essere maggiore di zero', type: 'error' });
        return;
      }

      setSaving(true);
      const token = localStorage.getItem('archibald_jwt');

      try {
        const response = await fetch('http://localhost:3000/api/users/me/target', {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ monthlyTarget: editTarget, currency: editCurrency })
        });

        if (response.ok) {
          const data = await response.json();
          setCurrentTarget(editTarget);
          setCurrentCurrency(editCurrency);
          setToast({ message: 'Obiettivo aggiornato con successo! ‚úì', type: 'success' });
        } else {
          setToast({ message: 'Errore nel salvare l\'obiettivo. Riprova.', type: 'error' });
        }
      } catch (error) {
        console.error('[ProfilePage] Save failed:', error);
        setToast({ message: 'Errore di connessione. Riprova.', type: 'error' });
      } finally {
        setSaving(false);
      }
    };
    ```

    **Styling (inline):**
    - Container: { maxWidth: '800px', margin: '0 auto', padding: '20px' }
    - Card: { backgroundColor: '#f8f9fa', borderRadius: '12px', padding: '20px', marginBottom: '20px' }
    - Title: { fontSize: '24px', fontWeight: 'bold', color: '#2c3e50', marginBottom: '16px' }
    - Section title: { fontSize: '18px', fontWeight: '600', color: '#2c3e50', marginBottom: '12px' }
    - Input: { width: '100%', padding: '10px', fontSize: '16px', borderRadius: '8px', border: '2px solid #e0e0e0' }
    - Button primary: { backgroundColor: '#3498db', color: '#fff', padding: '10px 20px', borderRadius: '8px', border: 'none', cursor: 'pointer' }
    - Button disabled: { backgroundColor: '#bdc3c7', cursor: 'not-allowed' }
    - Toast: { position: 'fixed', top: '20px', right: '20px', padding: '12px 20px', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0,0,0,0.15)', zIndex: 9999 }
    - Toast success: { backgroundColor: '#27ae60', color: '#fff' }
    - Toast error: { backgroundColor: '#e74c3c', color: '#fff' }

    Why separate current/edit state: Enables "Annulla" reset functionality, tracks changes for "Salva" button disable logic.
    Why toast not alert: Non-blocking feedback consistent with Phase 09-01 banking app UX.
  </action>
  <verify>
    npm run typecheck passes

    Manual check:
    1. ProfilePage renders without errors
    2. User info section displays fullName and username
    3. Target editor loads current target from API
    4. Currency dropdown shows EUR, USD, GBP with current selection
    5. Target input shows current value
    6. "Salva Modifiche" disabled if no changes
    7. "Annulla" resets form to original values
    8. "Salva Modifiche" calls PUT /api/users/me/target
    9. Success toast appears on save success
    10. Error toast appears on validation failure or network error
  </verify>
  <done>
    ProfilePage component created with user info and target editor.
    Target loaded from GET /api/users/me/target on mount.
    Form with currency dropdown and target number input.
    Save handler with PUT /api/users/me/target.
    Toast notifications for success/error feedback.
    "Annulla" button resets form to original state.
    "Salva Modifiche" disabled if no changes made.
    TypeScript compilation passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add /profile route and navigation link</name>
  <files>
    archibald-web-app/frontend/src/AppRouter.tsx,
    archibald-web-app/frontend/src/components/DashboardNav.tsx
  </files>
  <action>
    Integrate ProfilePage into routing and navigation:

    **Add route in AppRouter.tsx:**
    ```typescript
    import ProfilePage from './pages/ProfilePage';

    // Inside BrowserRouter:
    <Routes>
      <Route path="/" element={<Dashboard />} />
      <Route path="/orders" element={<CreateOrder />} />
      <Route path="/history" element={<OrderHistory />} />
      <Route path="/drafts" element={<DraftOrders />} />
      <Route path="/pending" element={<PendingOrders />} />
      <Route path="/customers" element={<CustomerList />} />
      <Route path="/articoli" element={<ProductList />} />
      <Route path="/admin" element={<AdminDashboard />} />
      <Route path="/profile" element={<ProfilePage />} />  {/* NEW */}
    </Routes>
    ```

    **Add navigation link in DashboardNav.tsx:**

    Position "Profilo" between "Dashboard" and "Ordini" (2nd position):

    ```typescript
    const links = [
      { path: '/', label: 'Dashboard', icon: 'üìä' },
      { path: '/profile', label: 'Profilo', icon: 'üë§' },  // NEW
      { path: '/orders', label: 'Ordini', icon: 'üìù' },
      { path: '/history', label: 'Storico', icon: 'üìã' },
      { path: '/drafts', label: 'Bozze', icon: 'üíæ' },
      { path: '/pending', label: 'Pending', icon: '‚è≥' },
      { path: '/customers', label: 'Clienti', icon: 'üë•' },
      { path: '/articoli', label: 'Articoli', icon: 'üì¶' },
      { path: '/admin', label: 'Admin', icon: '‚öôÔ∏è' }
    ];
    ```

    **Highlight active route:**
    Use `useLocation()` hook to detect active route and apply active style:
    ```typescript
    import { useLocation, Link } from 'react-router-dom';

    const location = useLocation();
    const isActive = location.pathname === link.path;

    // Style:
    const linkStyle = {
      ...baseStyle,
      backgroundColor: isActive ? '#3498db' : 'transparent',
      color: isActive ? '#fff' : '#2c3e50'
    };
    ```

    Why 2nd position: Profile is personal/user-specific, logically grouped near Dashboard (overview) before transactional pages (Ordini, Storico).
    Why icon üë§: Universal user profile icon, matches banking app conventions.
  </action>
  <verify>
    npm run typecheck passes

    Manual navigation test:
    1. Start frontend: npm run dev
    2. Click "Profilo" link in DashboardNav
    3. Verify: URL changes to /profile
    4. Verify: ProfilePage renders with user info and target editor
    5. Verify: "Profilo" link highlighted in DashboardNav (active state)
    6. Click "Dashboard" link
    7. Verify: URL changes to /, Dashboard renders
    8. Verify: "Dashboard" link highlighted (active state)
    9. Navigate to /profile directly via URL
    10. Verify: ProfilePage loads correctly
  </verify>
  <done>
    /profile route added to AppRouter.tsx.
    ProfilePage imported and configured.
    "Profilo" link added to DashboardNav (2nd position, icon üë§).
    Active route highlighting with useLocation().
    Navigation functional between Dashboard and Profile.
    TypeScript compilation passes.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes in frontend directory
- [ ] ProfilePage component created with user info and target editor
- [ ] Target loaded from API on mount
- [ ] Form validation prevents zero/negative targets
- [ ] "Salva Modifiche" saves target via PUT API
- [ ] Toast notifications provide success/error feedback
- [ ] /profile route added to AppRouter
- [ ] "Profilo" link added to DashboardNav
- [ ] Active route highlighting works
- [ ] Navigation between Dashboard and Profile functional
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- ProfilePage functional with target edit form
- API integration for loading and saving target
- Navigation link accessible from DashboardNav
- User can modify target from profile page
- Toast feedback for save operations
- No errors or warnings introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/16-target-wizard-setup/16-03-SUMMARY.md`:

# Phase 16 Plan 03: Profile Target Editor Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `archibald-web-app/frontend/src/pages/ProfilePage.tsx` - Description
- `archibald-web-app/frontend/src/AppRouter.tsx` - Description
- `archibald-web-app/frontend/src/components/DashboardNav.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 16-04-PLAN.md (Dashboard Integration & Real Data)
</output>
