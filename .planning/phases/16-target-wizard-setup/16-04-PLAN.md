---
phase: 16-target-wizard-setup
plan: 04
type: execute
---

<objective>
Integrate real target data into dashboard widgets and add edit link from dashboard to profile.

Purpose: Replace mock data in dashboard with live user target, complete end-to-end flow (wizard → dashboard → profile edit), enable self-service target management.
Output: Dashboard fetches real target via API, widgets display user's actual data, "Modifica target" link navigates to /profile.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-target-wizard-setup/16-01-SUMMARY.md
@.planning/phases/16-target-wizard-setup/16-02-SUMMARY.md
@.planning/phases/16-target-wizard-setup/16-03-SUMMARY.md
@.planning/phases/15-dashboard-homepage-ui/15-02-SUMMARY.md
@.planning/phases/15-dashboard-homepage-ui/15-04-SUMMARY.md

**Key files:**
@archibald-web-app/frontend/src/pages/Dashboard.tsx
@archibald-web-app/frontend/src/components/BudgetWidget.tsx
@archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx

**Tech stack available:**
- React 19 with hooks
- react-router-dom (useNavigate for programmatic navigation)
- TypeScript strict mode
- Inline styles (Phase 10-06 decision)
- fetch API for backend communication

**Established patterns:**
- Phase 15-02: BudgetWidget props (currentBudget, targetBudget, currency)
- Phase 15-04: TargetVisualizationWidget props (currentProgress, targetDescription, periodLabel)
- Phase 16-03: Toast notifications for feedback (5s auto-hide)
- Dashboard loads data on mount with useEffect

**Constraining decisions:**
- Dashboard fetches target from GET /api/users/me/target on mount
- Mock data replaced: currentBudget = 0 (Phase 17 will add real budget API)
- Progress calculation: currentBudget / targetBudget * 100
- "Modifica target" link positioned in BudgetWidget card (top-right corner)
- Link styled as subtle gray text with hover blue (banking app secondary action pattern)

**Current mock data (Phase 15):**
- BudgetWidget: currentBudget={7500}, targetBudget={10000}, currency="EUR"
- TargetVisualizationWidget: currentProgress={67}, targetDescription="Target Mensile", periodLabel="Gennaio 2026"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fetch real target data in Dashboard and pass to widgets</name>
  <files>
    archibald-web-app/frontend/src/pages/Dashboard.tsx
  </files>
  <action>
    Replace mock data with real API fetch in Dashboard.tsx:

    **Add state for target:**
    ```typescript
    const [targetData, setTargetData] = useState<{
      monthlyTarget: number;
      currency: string;
    } | null>(null);
    const [loading, setLoading] = useState(true);
    ```

    **Fetch target on mount:**
    ```typescript
    useEffect(() => {
      const fetchTarget = async () => {
        const token = localStorage.getItem('archibald_jwt');
        if (!token) {
          setLoading(false);
          return;
        }

        try {
          const response = await fetch('http://localhost:3000/api/users/me/target', {
            headers: { 'Authorization': `Bearer ${token}` }
          });

          if (response.ok) {
            const data = await response.json();
            setTargetData(data);
          } else {
            console.error('[Dashboard] Failed to load target:', await response.text());
          }
        } catch (error) {
          console.error('[Dashboard] Target fetch error:', error);
        } finally {
          setLoading(false);
        }
      };

      fetchTarget();
    }, []);
    ```

    **Update widget props with real data:**
    ```typescript
    // Replace mock props:
    // OLD: <BudgetWidget currentBudget={7500} targetBudget={10000} currency="EUR" />
    // NEW:
    {targetData && (
      <BudgetWidget
        currentBudget={0}  // TODO Phase 17: Real budget from /api/metrics/budget
        targetBudget={targetData.monthlyTarget}
        currency={targetData.currency}
      />
    )}

    // OLD: <TargetVisualizationWidget currentProgress={67} targetDescription="Target Mensile" periodLabel="Gennaio 2026" />
    // NEW:
    {targetData && (
      <TargetVisualizationWidget
        currentProgress={0}  // TODO Phase 17: Real progress from budget / target * 100
        targetDescription="Target Mensile"
        periodLabel={new Date().toLocaleDateString('it-IT', { month: 'long', year: 'numeric' })}
      />
    )}
    ```

    **Loading state:**
    Display loading skeleton or placeholder while fetching:
    ```typescript
    if (loading) {
      return (
        <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px', textAlign: 'center' }}>
          <p style={{ fontSize: '18px', color: '#7f8c8d' }}>Caricamento dashboard...</p>
        </div>
      );
    }

    if (!targetData) {
      return (
        <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '20px', textAlign: 'center' }}>
          <p style={{ fontSize: '18px', color: '#e74c3c' }}>Errore nel caricare il target.</p>
        </div>
      );
    }
    ```

    Why currentBudget = 0: Phase 17 will add real budget metrics API, placeholder prevents undefined errors.
    Why currentProgress = 0: Calculated from budget API (not available yet), 0 shows "empty state" motivational message in TargetVisualizationWidget.
    Why periodLabel dynamic: Current month/year updates automatically, no manual updates needed.
  </action>
  <verify>
    npm run typecheck passes

    Manual check:
    1. Dashboard loads without errors
    2. Loading state displays briefly during fetch
    3. BudgetWidget shows real target from database (e.g., 10000)
    4. Currency displays correctly (EUR, USD, or GBP)
    5. TargetVisualizationWidget shows current month/year dynamically
    6. If target not set (monthlyTarget = 0), widgets should handle gracefully
    7. Check browser console: No errors, target fetch succeeds
    8. Check network tab: GET /api/users/me/target returns 200
  </verify>
  <done>
    Dashboard fetches target via GET /api/users/me/target on mount.
    targetData state holds monthlyTarget and currency.
    BudgetWidget receives real targetBudget and currency props.
    TargetVisualizationWidget receives dynamic periodLabel (current month/year).
    Loading state displays during fetch.
    Error state handles fetch failures gracefully.
    currentBudget and currentProgress set to 0 (Phase 17 placeholders).
    TypeScript compilation passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add "Modifica target" link from BudgetWidget to profile</name>
  <files>
    archibald-web-app/frontend/src/components/BudgetWidget.tsx
  </files>
  <action>
    Add edit link to BudgetWidget for easy target modification access:

    **Import useNavigate:**
    ```typescript
    import { useNavigate } from 'react-router-dom';

    // Inside component:
    const navigate = useNavigate();
    ```

    **Add edit link in widget header:**
    Position "Modifica" link in top-right corner next to "Budget Mensile" title:

    ```typescript
    // Container for title + link:
    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
      <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: '#2c3e50', margin: 0 }}>
        Budget Mensile
      </h3>
      <button
        onClick={() => navigate('/profile')}
        style={{
          backgroundColor: 'transparent',
          border: 'none',
          color: '#7f8c8d',
          fontSize: '14px',
          cursor: 'pointer',
          textDecoration: 'underline',
          transition: 'color 0.2s'
        }}
        onMouseEnter={(e) => e.currentTarget.style.color = '#3498db'}
        onMouseLeave={(e) => e.currentTarget.style.color = '#7f8c8d'}
      >
        Modifica target
      </button>
    </div>
    ```

    **Alternative: Icon-based edit link**
    If text link too prominent, use icon (⚙️ or ✏️) in top-right:
    ```typescript
    <span
      onClick={() => navigate('/profile')}
      style={{
        cursor: 'pointer',
        fontSize: '18px',
        color: '#7f8c8d',
        transition: 'color 0.2s'
      }}
      onMouseEnter={(e) => e.currentTarget.style.color = '#3498db'}
      onMouseLeave={(e) => e.currentTarget.style.color = '#7f8c8d'}
      title="Modifica target"
    >
      ⚙️
    </span>
    ```

    **Recommended**: Text link for discoverability (users need to know target is editable), icon less obvious.

    Why in BudgetWidget not TargetVisualizationWidget: BudgetWidget is primary metric display, users associate budget with target setting.
    Why navigate not Link: Programmatic navigation on button click, consistent with existing patterns.
  </action>
  <verify>
    npm run typecheck passes

    Manual check:
    1. BudgetWidget displays "Modifica target" link in top-right
    2. Link styled as gray text with underline
    3. Hover changes color to blue (#3498db)
    4. Click navigates to /profile
    5. ProfilePage loads with target editor
    6. Link has proper cursor pointer
    7. Link position doesn't break widget layout
  </verify>
  <done>
    "Modifica target" link added to BudgetWidget header.
    useNavigate hook integrated for navigation.
    Link positioned in top-right corner next to title.
    Hover effect changes color from gray to blue.
    Click navigates to /profile page.
    TypeScript compilation passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete target flow: wizard → dashboard → profile edit</what-built>
  <how-to-verify>
    Test the complete end-to-end target management flow:

    1. **Reset test environment:**
       - Delete `backend/data/users.db` (force fresh user with target = 0)
       - Start backend: `cd archibald-web-app/backend && npm run dev`
       - Start frontend: `cd archibald-web-app/frontend && npm run dev`

    2. **Test wizard flow:**
       - Navigate to http://localhost:5173/
       - Login with ikiA0930 credentials
       - Verify: TargetWizard modal appears immediately after login
       - Complete wizard:
         - Step 1: Click "Inizia"
         - Step 2: Enter target 15000, select EUR, click "Continua"
         - Step 3: Verify preview shows "€15,000", click "Conferma"
       - Verify: Wizard disappears, Dashboard loads

    3. **Test dashboard with real data:**
       - Verify: BudgetWidget shows "Target: €15,000" (not mock 10000)
       - Verify: TargetVisualizationWidget shows current month/year
       - Verify: "Modifica target" link visible in BudgetWidget top-right
       - Verify: Currency formatting matches selected currency (EUR)

    4. **Test profile edit:**
       - Click "Modifica target" link in BudgetWidget
       - Verify: Navigates to /profile page
       - Verify: Target editor shows current target (15000 EUR)
       - Change target to 20000, currency to USD
       - Click "Salva Modifiche"
       - Verify: Success toast appears "Obiettivo aggiornato con successo! ✓"
       - Click "Dashboard" link in nav
       - Verify: BudgetWidget now shows "Target: $20,000" (USD formatting)

    5. **Test persistence across sessions:**
       - Logout (if logout button exists) or close tab
       - Open http://localhost:5173/ in new tab
       - Login with ikiA0930
       - Verify: TargetWizard does NOT appear (target already set)
       - Verify: Dashboard loads immediately with target $20,000

    6. **Test navigation:**
       - Click "Profilo" link in DashboardNav
       - Verify: /profile page loads
       - Verify: "Profilo" link highlighted in nav (active state)
       - Click "Dashboard" link
       - Verify: Dashboard loads
       - Verify: "Dashboard" link highlighted

    7. **Browser console checks:**
       - No TypeScript errors
       - No runtime errors
       - API calls succeed (check Network tab for 200 responses)

    Mark checkpoint complete when all flows work end-to-end without errors.
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes in frontend directory
- [ ] Dashboard fetches target from API on mount
- [ ] BudgetWidget displays real target (not mock data)
- [ ] TargetVisualizationWidget displays dynamic period label
- [ ] "Modifica target" link added to BudgetWidget
- [ ] Link navigates to /profile on click
- [ ] Complete wizard → dashboard → edit flow functional
- [ ] Target persists across logout/login sessions
- [ ] Human verification checkpoint completed
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Dashboard uses real target data from API
- Mock data replaced with live user target
- "Modifica target" link provides easy access to profile
- Complete end-to-end flow tested and verified
- Target management fully functional (create, view, edit)
- No errors or warnings introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/16-target-wizard-setup/16-04-SUMMARY.md`:

# Phase 16 Plan 04: Dashboard Integration & Real Data Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `archibald-web-app/frontend/src/pages/Dashboard.tsx` - Description
- `archibald-web-app/frontend/src/components/BudgetWidget.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 16 complete. Ready for Phase 17 (Dashboard Metrics Backend).
</output>
