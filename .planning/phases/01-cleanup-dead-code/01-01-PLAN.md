---
phase: 01-cleanup-dead-code
plan: 01
type: execute
---

<objective>
Run comprehensive dead code analysis with Knip and remove all confirmed orphan files from frontend and backend. Also commit all pending changes from previous refactoring as a clean baseline.

Purpose: Establish a clean codebase where every file serves a purpose — solid foundation for fix phases 2-10.
Output: Knip report saved for subsequent plans, all orphan files deleted, all pending git changes committed cleanly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cleanup-dead-code/1-CONTEXT.md
@.planning/phases/01-cleanup-dead-code/1-RESEARCH.md

**Vision (from CONTEXT.md):** Cancellazione diretta dei file morti — git è il safety net, niente _deprecated/. Alla fine ogni riga rimasta deve servire a qualcosa.

**From RESEARCH.md:** Use Knip (npx knip) with workspace config for frontend+backend. Analyze report, filter false positives, then manual removal (not auto-fix for first run). Verify build/test after each batch.

**Pending git changes (from previous refactoring — NOT yet committed):**
- Modified: archibald-bot.ts, pool.ts, pool.spec.ts, main.ts, pdf-parser-service.spec.ts, Dockerfile, AppRouter.tsx, deploy-vps.sh, docker-compose.yml
- Deleted: 4 frontend components (OrdersSummaryWidget, SyncBanner, BonusRoadmapWidget, ForecastWidget) + 10 backend files (test renames, orphan files)
- Untracked new: 6 sync handlers, 3 spec files, .env.example, scripts/archive/

**Frontend orphans confirmed (not imported anywhere):**
1. TargetVisualizationWidget.tsx
2. ManualSyncBanner.tsx
3. BudgetWidget.tsx
4. CommissionsWidget.tsx
5. PriceSyncNotification.tsx
6. SyncMonitoringDashboard.tsx
7. ExcelPriceManager.tsx + ExcelPriceManager.css

**Note:** Do NOT delete UnifiedSyncProgress.tsx — it will be reactivated in Phase 5 (WebSocket). Only clean up commented-out references in AppRouter.tsx.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Knip config and run dead code analysis</name>
  <files>knip.json</files>
  <action>
  1. Create `knip.json` at project root with this workspace config:
     ```json
     {
       "$schema": "https://unpkg.com/knip@5/schema.json",
       "workspaces": {
         "archibald-web-app/frontend": {
           "entry": ["src/main.tsx"],
           "project": ["src/**/*.{ts,tsx}"],
           "ignore": ["src/vite-env.d.ts"]
         },
         "archibald-web-app/backend": {
           "entry": ["src/main.ts"],
           "project": ["src/**/*.ts"],
           "ignore": ["src/**/*.spec.ts", "src/**/*.test.ts", "src/scripts/**"]
         }
       }
     }
     ```
  2. Run `npx knip --reporter compact 2>&1 | tee .planning/phases/01-cleanup-dead-code/knip-report.txt`
  3. Review the Knip report and categorize:
     - **files**: Unused files (compare with known orphan list — should overlap)
     - **exports**: Unused exports (save for Plan 01-02)
     - **types**: Unused types (save for Plan 01-02)
     - **dependencies**: Unused npm packages (note but don't act — out of scope)
  4. Cross-reference Knip findings with the 7 known frontend orphans listed in context. Note any ADDITIONAL orphans found by Knip.

  **Pitfalls to avoid:**
  - Do NOT blindly trust Knip for files imported dynamically or via CSS imports
  - Do NOT remove files that have side effects (polyfills, CSS-only imports)
  - UnifiedSyncProgress is intentionally kept — it's NOT dead code (Phase 5 will reactivate it)
  </action>
  <verify>knip.json exists at project root. knip-report.txt saved in phase directory. Report reviewed and categorized.</verify>
  <done>Knip analysis complete. All findings categorized. Known orphans confirmed. Any additional orphans identified.</done>
</task>

<task type="auto">
  <name>Task 2: Delete orphan files and commit all pending changes</name>
  <files>
  archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx,
  archibald-web-app/frontend/src/components/ManualSyncBanner.tsx,
  archibald-web-app/frontend/src/components/BudgetWidget.tsx,
  archibald-web-app/frontend/src/components/CommissionsWidget.tsx,
  archibald-web-app/frontend/src/components/PriceSyncNotification.tsx,
  archibald-web-app/frontend/src/components/SyncMonitoringDashboard.tsx,
  archibald-web-app/frontend/src/components/ExcelPriceManager.tsx,
  archibald-web-app/frontend/src/components/ExcelPriceManager.css
  </files>
  <action>
  **Step 1 — Commit baseline (previous refactoring changes):**
  Stage and commit all currently modified, deleted, and new untracked files from previous refactoring work:
  - Modified files: archibald-bot.ts, pool.ts, pool.spec.ts, main.ts, pdf-parser-service.spec.ts, Dockerfile, AppRouter.tsx, deploy-vps.sh, docker-compose.yml
  - Already-deleted files: 4 frontend components + 10 backend files (test renames, orphan removals, archive moves)
  - New untracked files: 6 sync handlers, 3 spec files, .env.example, scripts/archive/
  Commit message: `refactor: commit pending changes from IndexedDB/BullMQ refactoring`

  **Step 2 — Delete orphan frontend components:**
  Delete these 7 components + 1 CSS confirmed as orphaned (zero imports in codebase):
  1. `rm archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx`
  2. `rm archibald-web-app/frontend/src/components/ManualSyncBanner.tsx`
  3. `rm archibald-web-app/frontend/src/components/BudgetWidget.tsx`
  4. `rm archibald-web-app/frontend/src/components/CommissionsWidget.tsx`
  5. `rm archibald-web-app/frontend/src/components/PriceSyncNotification.tsx`
  6. `rm archibald-web-app/frontend/src/components/SyncMonitoringDashboard.tsx`
  7. `rm archibald-web-app/frontend/src/components/ExcelPriceManager.tsx`
  8. `rm archibald-web-app/frontend/src/components/ExcelPriceManager.css`

  Also delete any ADDITIONAL orphan files discovered by Knip in Task 1 (after verifying they're truly unused).

  **Step 3 — Clean up commented-out code in AppRouter.tsx:**
  Remove the commented-out UnifiedSyncProgress import line. Do NOT delete the component file itself.

  **Step 4 — Verify and commit:**
  - Run `npm run type-check --prefix archibald-web-app/frontend`
  - Run `npm run build --prefix archibald-web-app/backend`
  - Run `npm test --prefix archibald-web-app/frontend`
  - Run `npm test --prefix archibald-web-app/backend`
  - If all pass, commit: `refactor(01-01): remove orphan frontend components and dead files`
  </action>
  <verify>
  `npm run type-check --prefix archibald-web-app/frontend` passes.
  `npm run build --prefix archibald-web-app/backend` passes.
  `npm test --prefix archibald-web-app/frontend` passes.
  `npm test --prefix archibald-web-app/backend` passes.
  All 8 orphan files deleted. git log shows 2 clean commits.
  </verify>
  <done>All orphan files removed. Frontend and backend build and test clean. Two commits: baseline + orphan removal.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] knip.json exists at project root
- [ ] knip-report.txt saved in .planning/phases/01-cleanup-dead-code/
- [ ] All 8 frontend orphan files deleted (7 .tsx + 1 .css)
- [ ] Any additional Knip-discovered orphans deleted
- [ ] Commented-out UnifiedSyncProgress import removed from AppRouter.tsx
- [ ] `npm run type-check --prefix archibald-web-app/frontend` passes
- [ ] `npm run build --prefix archibald-web-app/backend` passes
- [ ] `npm test --prefix archibald-web-app/frontend` passes
- [ ] `npm test --prefix archibald-web-app/backend` passes
- [ ] git log shows clean commits
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors or test failures introduced
- Knip report available for Plan 01-02 reference
- Codebase contains zero orphan component files
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-dead-code/01-01-SUMMARY.md`:

# Phase 1 Plan 01: Knip Analysis & Orphan File Removal Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Knip Findings Summary

- Files: [N orphans found, M confirmed and deleted]
- Exports: [N unused exports found — deferred to Plan 01-02]
- Types: [N unused types found — deferred to Plan 01-02]
- Dependencies: [N unused — noted but out of scope]

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 01-02-PLAN.md (Dead Exports, Naming Fix & Legacy Cleanup)
</output>
