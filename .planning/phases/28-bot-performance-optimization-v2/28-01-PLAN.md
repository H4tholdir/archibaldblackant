---
phase: 28-bot-performance-optimization-v2
plan: 01
type: execute
---

<objective>
Apply aggressive bot optimizations to achieve <60s per order (from current ~82s).

Purpose: Final performance push to hit production target of <60s order creation time.
Output: Optimized bot achieving consistent <60s order creation with -27% improvement.
</objective>

<context>
@.planning/phases/27-bot-performance-profiling-v2/ANALYSIS-V2.md
@.planning/phases/3-bot-performance-optimization/

**Current baseline**: ~82s (post-Phase 3.2)
**Target**: <60s (-22s, -27% improvement)

**Optimization strategies** (based on Phase 27 analysis):
- Eliminate remaining networkidle2 waits (replace with specific selectors)
- Aggressive timeout reductions (use minimum safe timeouts)
- Parallel operations where possible (multiple autocomplete lookups)
- Pre-fetch strategies (preload customer/product data before form)
- Form submission optimization (reduce confirmation wait)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply identified optimizations to archibald-bot.ts</name>
  <files>backend/src/archibald-bot.ts</files>
  <action>
    Implement Phase 27 recommended optimizations:
    - Replace all remaining networkidle2 with specific selectors
    - Reduce confirmation wait timeout (current 22s â†’ target 15s)
    - Optimize customer/product autocomplete (parallel lookups if multiple items)
    - Pre-fetch customer data before navigating to order form
    - Minimize form navigation delays

    Target cumulative savings: -22s
  </action>
  <verify>Order creation completes in <60s</verify>
  <done>Aggressive optimizations applied. TypeScript passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Optimized bot achieving <60s order creation</what-built>
  <how-to-verify>
    1. Start backend
    2. Create 10 test orders via API
    3. Monitor logs for [PERF-V2] timing entries
    4. Calculate average order creation time
    5. Verify: avg time <60s (target achieved)
    6. Check performance breakdown:
       - Login: <6s (reduced from 8s with Phase 26 cached contexts)
       - Navigation: <8s (reduced from 12s)
       - Form filling: <20s (reduced from 25s)
       - Submission: <12s (reduced from 15s)
       - Confirmation: <15s (reduced from 22s)
    7. Verify all orders complete successfully (no errors due to aggressive timeouts)
    8. Test edge cases (slow network, large orders)

    Success: Consistent <60s order creation, 27% improvement from 82s baseline, no reliability regressions.
  </how-to-verify>
  <resume-signal>Type "approved"</resume-signal>
</task>

</tasks>

<verification>
- [ ] Optimizations applied to archibald-bot.ts
- [ ] Order creation time <60s consistently
- [ ] No TypeScript errors
- [ ] No reliability regressions
- [ ] User verification passed
</verification>

<success_criteria>
- Order creation time <60s (target achieved)
- 27% improvement from 82s baseline
- All optimization strategies implemented
- Reliability maintained (no errors)
- Production-ready performance
- User verification passed
</success_criteria>

<output>
Create `.planning/phases/28-bot-performance-optimization-v2/28-01-SUMMARY.md` with final performance comparison:

| Metric | Baseline (v1.0) | Phase 3.2 | Phase 28 (v2.0) | Total Improvement |
|--------|----------------|-----------|-----------------|-------------------|
| Order creation | 90s | 82s | <60s | -30s (-33%) |
| Login | 10s | 8s | <6s | -4s (-40%) |
| Navigation | 15s | 12s | <8s | -7s (-47%) |
| Form filling | 30s | 25s | <20s | -10s (-33%) |
| Submission | 15s | 15s | <12s | -3s (-20%) |
| Confirmation | 20s | 22s | <15s | -5s (-25%) |
</output>
