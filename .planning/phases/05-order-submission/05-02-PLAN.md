---
phase: 05-order-submission
plan: "02"
type: execute
depends_on: ["05-01"]
---

# Plan 05-02: Frontend Progress UI & Toast Notifications

<objective>
Create real-time order progress UI component with step-by-step status display, time remaining estimate, minimizable to background, and non-invasive toast notifications for success/error states, allowing agents to multitask while orders process.
</objective>

<execution_context>
**Phase Goal**: Enhance UX with visual progress tracking and notifications.

**Dependencies**: Plan 05-01 (WebSocket progress tracking) must be complete.

**User Requirements** (from 05-CONTEXT.md + new requirement):
1. **Step-by-step progress display**: Show specific steps with status icons (‚úÖ ‚è≥ ‚è∏Ô∏è)
2. **Time remaining estimate**: ~45s countdown that updates dynamically
3. **Toast notification**: Green, non-invasive, auto-dismiss after few seconds
4. **Error messages**: Human-readable with actionable guidance
5. **Global background mode**: Agent can navigate to other pages while bot processes order
6. **Adaptive badge visibility**:
   - Visible on OrderForm page (with full details)
   - Hidden on other pages during processing (to not obstruct UX)
   - Reappears on ALL pages when complete (for notification)
7. **Completion banner**: Discrete notification when order complete, then auto-dismiss

**Existing Frontend**:
- OrderStatus.tsx exists but shows basic progress bar (10%, 25%, 100%)
- Polling-based status updates (2s interval)
- No WebSocket integration on frontend yet
- React + TypeScript

**Design Principles**:
- Non-blocking: Agent can navigate anywhere in app while bot processes
- Global persistence: State persists across pages (App-level), badge shows conditionally
- UX-aware: Badge hidden on non-OrderForm pages to avoid obstructing content
- Notification-driven: Badge reappears everywhere when order completes
- Clear: On OrderForm page, always visible with full step-by-step details
- Actionable: Errors tell user what to do next
- True multitasking: Agent can browse customers, check products freely
</execution_context>

<context>
@archibald-web-app/frontend/src/components/OrderStatus.tsx (existing basic status)
@archibald-web-app/frontend/src/components/OrderForm.tsx (lines 1-100: form structure)
@.planning/phases/05-order-submission/05-CONTEXT.md
@.planning/phases/05-order-submission/05-01-PLAN.md (WebSocket progress format)
</context>

<tasks>
  <task type="auto">
    <description>Create global OrderProgressBadge with App-level state management</description>
    <instructions>
Create **global** order progress system that persists across page navigation.

**Architecture**: App-level state + global badge component

**Step 1: Create global order tracking context**

File: `archibald-web-app/frontend/src/contexts/OrderTrackingContext.tsx`

```typescript
import { createContext, useContext, useState, useEffect, ReactNode } from 'react';

interface ActiveOrder {
  jobId: string;
  currentStep: number;
  estimatedRemainingSeconds: number;
  status: 'connecting' | 'active' | 'complete' | 'error';
  customerName?: string;
}

interface OrderTrackingContextType {
  activeOrder: ActiveOrder | null;
  startTracking: (jobId: string, customerName?: string) => void;
  stopTracking: () => void;
}

const OrderTrackingContext = createContext<OrderTrackingContextType | undefined>(undefined);

export function OrderTrackingProvider({ children }: { children: ReactNode }) {
  const [activeOrder, setActiveOrder] = useState<ActiveOrder | null>(null);

  const startTracking = (jobId: string, customerName?: string) => {
    setActiveOrder({
      jobId,
      currentStep: 0,
      estimatedRemainingSeconds: 82,
      status: 'connecting',
      customerName,
    });
  };

  const stopTracking = () => {
    setActiveOrder(null);
  };

  // WebSocket connection management (global, persists across pages)
  useEffect(() => {
    if (!activeOrder) return;

    const ws = new WebSocket(`ws://localhost:3000/ws/sync?jobId=${activeOrder.jobId}`);

    ws.onopen = () => {
      setActiveOrder(prev => prev ? { ...prev, status: 'active' } : null);
    };

    ws.onmessage = (event) => {
      const message = JSON.parse(event.data);
      if (message.type === 'order_progress') {
        const { percent, estimatedRemainingSeconds } = message.data;

        setActiveOrder(prev => {
          if (!prev) return null;
          return {
            ...prev,
            currentStep: Math.floor(percent / 11.11), // 9 steps, ~11% each
            estimatedRemainingSeconds: estimatedRemainingSeconds || prev.estimatedRemainingSeconds,
          };
        });

        if (percent === 100) {
          setActiveOrder(prev => prev ? { ...prev, status: 'complete' } : null);
        }
      }
    };

    ws.onerror = () => {
      setActiveOrder(prev => prev ? { ...prev, status: 'error' } : null);
    };

    return () => {
      ws.close();
    };
  }, [activeOrder?.jobId]);

  return (
    <OrderTrackingContext.Provider value={{ activeOrder, startTracking, stopTracking }}>
      {children}
    </OrderTrackingContext.Provider>
  );
}

export function useOrderTracking() {
  const context = useContext(OrderTrackingContext);
  if (!context) {
    throw new Error('useOrderTracking must be used within OrderTrackingProvider');
  }
  return context;
}
```

**Step 2: Create adaptive global badge component**

File: `archibald-web-app/frontend/src/components/GlobalOrderBadge.tsx`

```typescript
import { useOrderTracking } from '../contexts/OrderTrackingContext';
import { useLocation } from 'react-router-dom'; // or your router library

const STEP_LABELS = [
  'Inizializzazione browser',
  'Verifica sessione',
  'Sessione validata',
  'Selezione cliente',
  'Cliente selezionato',
  'Aggiunta articoli',
  'Articoli aggiunti',
  'Salvataggio ordine',
  'Ordine creato',
];

export function GlobalOrderBadge() {
  const { activeOrder } = useOrderTracking();
  const location = useLocation();

  if (!activeOrder) return null;

  // Determine if we're on the order form page
  const isOrderFormPage = location.pathname === '/' || location.pathname.includes('/order');

  // Adaptive visibility logic:
  // - Show on order form page while processing (active/connecting)
  // - Show everywhere when complete or error (notification)
  // - Hide on other pages while processing (to not obstruct UX)
  const shouldShowBadge =
    isOrderFormPage ||
    activeOrder.status === 'complete' ||
    activeOrder.status === 'error';

  if (!shouldShowBadge) return null;

  const formatTime = (seconds: number) => {
    if (seconds < 60) return `${seconds}s`;
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}m ${secs}s`;
  };

  const getStatusIcon = () => {
    switch (activeOrder.status) {
      case 'active': return '‚è≥';
      case 'complete': return '‚úÖ';
      case 'error': return '‚ùå';
      case 'connecting': return 'üîÑ';
    }
  };

  return (
    <div className="global-order-badge">
      <div className="badge-icon">{getStatusIcon()}</div>
      <div className="badge-content">
        <div className="badge-title">
          {activeOrder.status === 'complete' ? 'Ordine completato' : 'Ordine in elaborazione'}
          {activeOrder.customerName && ` - ${activeOrder.customerName}`}
        </div>
        <div className="badge-progress">
          {STEP_LABELS[activeOrder.currentStep]} ‚Ä¢ {formatTime(activeOrder.estimatedRemainingSeconds)}
        </div>
      </div>
    </div>
  );
}
```

**Step 3: Wire into App.tsx for global visibility**

File: `archibald-web-app/frontend/src/App.tsx`

```typescript
import { OrderTrackingProvider } from './contexts/OrderTrackingContext';
import { GlobalOrderBadge } from './components/GlobalOrderBadge';

function App() {
  return (
    <OrderTrackingProvider>
      <div className="app">
        {/* Existing app content - routes, pages, etc. */}

        {/* Global badge - visible on ALL pages */}
        <GlobalOrderBadge />
      </div>
    </OrderTrackingProvider>
  );
}

export default App;
```

**CSS styles** (add to App.css):
```css
/* Global badge - visible across all pages */
.global-order-badge {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  background: white;
  border: 2px solid #667eea;
  border-radius: 8px;
  padding: 0.75rem 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s;
  z-index: 9999; /* Above everything - must be visible on all pages */
  min-width: 300px;
  max-width: 400px;
  animation: slideIn 0.3s ease-out;
}

.global-order-badge:hover {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  transform: translateY(-2px);
}

.badge-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.badge-content {
  flex: 1;
  min-width: 0;
}

.badge-title {
  font-weight: 600;
  color: #374151;
  font-size: 0.875rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.badge-progress {
  font-size: 0.75rem;
  color: #6b7280;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.time-estimate {
  font-size: 1.125rem;
  margin: 1rem 0;
  color: #374151;
}

.progress-steps {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.progress-step {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: 6px;
  transition: background 0.2s;
}

.progress-step.complete {
  background: #d1fae5;
}

.progress-step.in_progress {
  background: #fef3c7;
  animation: pulse 2s infinite;
}

.progress-step.pending {
  background: #f3f4f6;
  opacity: 0.6;
}

.step-icon {
  font-size: 1.25rem;
}

.step-label {
  flex: 1;
  font-weight: 500;
}

.step-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid #e5e7eb;
  border-top-color: #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
```

**Step 4: Handle completion with banner notification**

When order completes, show toast + auto-dismiss badge after delay:

```typescript
// In OrderTrackingContext, after status becomes 'complete'
useEffect(() => {
  if (activeOrder?.status === 'complete') {
    // Fetch order ID for toast
    fetch(`/api/orders/status/${activeOrder.jobId}`)
      .then(res => res.json())
      .then(data => {
        if (data.success && data.data.result) {
          // Show success toast (handled by OrderForm)
          window.dispatchEvent(new CustomEvent('order-complete', {
            detail: { orderId: data.data.result.orderId }
          }));
        }
      });

    // Auto-dismiss badge after 5 seconds
    const timer = setTimeout(() => {
      stopTracking();
    }, 5000);

    return () => clearTimeout(timer);
  }
}, [activeOrder?.status]);
```

**Acceptance criteria**:
- OrderTrackingContext manages global WebSocket connection
- GlobalOrderBadge has adaptive visibility logic:
  - Visible on OrderForm page during processing (active/connecting)
  - Hidden on other pages during processing (to not obstruct)
  - Visible everywhere when complete/error (notification)
- Badge shows current step + time remaining when visible
- State persists during page navigation (even when badge hidden)
- WebSocket connection survives page changes
- Completion triggers toast + badge reappears + auto-dismisses after 5s
- TypeScript compiles without errors
    </instructions>
  </task>

  <task type="auto">
    <description>Create Toast notification component for success/error feedback</description>
    <instructions>
Create reusable toast notification system in `archibald-web-app/frontend/src/components/Toast.tsx`.

**Component interface**:
```typescript
interface ToastProps {
  message: string;
  type: 'success' | 'error' | 'info';
  duration?: number; // Auto-dismiss after N ms (default 5000)
  onClose: () => void;
}
```

**Implementation**:
```typescript
import { useEffect } from 'react';

export function Toast({ message, type, duration = 5000, onClose }: ToastProps) {
  useEffect(() => {
    const timer = setTimeout(() => {
      onClose();
    }, duration);

    return () => clearTimeout(timer);
  }, [duration, onClose]);

  const getTypeStyles = () => {
    switch (type) {
      case 'success':
        return { background: '#d1fae5', color: '#065f46', icon: '‚úÖ' };
      case 'error':
        return { background: '#fee2e2', color: '#991b1b', icon: '‚ùå' };
      case 'info':
        return { background: '#dbeafe', color: '#1e40af', icon: '‚ÑπÔ∏è' };
    }
  };

  const styles = getTypeStyles();

  return (
    <div
      className="toast"
      style={{
        position: 'fixed',
        top: '1rem',
        right: '1rem',
        background: styles.background,
        color: styles.color,
        padding: '1rem 1.5rem',
        borderRadius: '8px',
        boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
        display: 'flex',
        alignItems: 'center',
        gap: '0.75rem',
        minWidth: '320px',
        maxWidth: '500px',
        zIndex: 9999,
        animation: 'slideIn 0.3s ease-out',
      }}
    >
      <span style={{ fontSize: '1.5rem' }}>{styles.icon}</span>
      <span style={{ flex: 1, fontWeight: 500 }}>{message}</span>
      <button
        onClick={onClose}
        style={{
          background: 'transparent',
          border: 'none',
          cursor: 'pointer',
          fontSize: '1.25rem',
          color: styles.color,
          opacity: 0.7,
        }}
      >
        √ó
      </button>
    </div>
  );
}

// Add to App.css
const toastStyles = `
@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
`;
```

**Toast Manager Hook** (for easy usage):
```typescript
// archibald-web-app/frontend/src/hooks/useToast.ts
import { useState, useCallback } from 'react';

interface ToastState {
  message: string;
  type: 'success' | 'error' | 'info';
  id: number;
}

export function useToast() {
  const [toasts, setToasts] = useState<ToastState[]>([]);

  const showToast = useCallback((message: string, type: 'success' | 'error' | 'info') => {
    const id = Date.now();
    setToasts(prev => [...prev, { message, type, id }]);
  }, []);

  const hideToast = useCallback((id: number) => {
    setToasts(prev => prev.filter(t => t.id !== id));
  }, []);

  return { toasts, showToast, hideToast };
}
```

**Acceptance criteria**:
- Toast component renders with success/error/info types
- Auto-dismisses after configurable duration
- Manual close button works
- Slide-in animation smooth
- Multiple toasts stack vertically
- TypeScript compiles without errors
    </instructions>
  </task>

  <task type="auto">
    <description>Integrate progress tracker and toasts into OrderForm workflow</description>
    <instructions>
Update OrderForm.tsx to use new OrderProgressTracker and Toast components.

**Integration in OrderForm.tsx**:
```typescript
import { useOrderTracking } from '../contexts/OrderTrackingContext';
import { Toast } from './Toast';
import { useToast } from '../hooks/useToast';
import { useEffect } from 'react';

export default function OrderForm({ onOrderCreated }: OrderFormProps) {
  const { startTracking } = useOrderTracking();
  const { toasts, showToast, hideToast } = useToast();

  // Listen for order completion events from global context
  useEffect(() => {
    const handleOrderComplete = (event: CustomEvent) => {
      const { orderId } = event.detail;
      showToast(`Ordine #${orderId} creato con successo!`, 'success');
      // Form persists - agent can immediately create next order
    };

    window.addEventListener('order-complete', handleOrderComplete as EventListener);
    return () => {
      window.removeEventListener('order-complete', handleOrderComplete as EventListener);
    };
  }, []);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const response = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          customerName,
          items,
        }),
      });

      const data = await response.json();

      if (data.success) {
        // Start global tracking - badge will appear and persist across navigation
        startTracking(data.jobId, customerName);

        // Agent can now navigate away - badge follows them
        showToast('Ordine inviato! Puoi continuare a lavorare.', 'info');
      } else {
        showToast(
          data.error || 'Errore durante la creazione dell\'ordine',
          'error'
        );
      }
    } catch (error) {
      showToast(
        'Errore di rete. Controlla la connessione e riprova.',
        'error'
      );
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      {/* Form always visible - no progress tracker in page */}
      <form onSubmit={handleSubmit}>
        {/* ... existing form fields ... */}
        <button type="submit" disabled={loading}>
          {loading ? 'Invio...' : 'Crea Ordine'}
        </button>
      </form>

      {/* Toast notifications */}
      {toasts.map(toast => (
        <Toast
          key={toast.id}
          message={toast.message}
          type={toast.type}
          onClose={() => hideToast(toast.id)}
        />
      ))}

      {/* No inline progress tracker - global badge handles it */}
    </div>
  );
}
```

**Enhanced error messages** (human-readable with actionable guidance):
```typescript
const ERROR_MESSAGES: Record<string, string> = {
  'TIMEOUT': 'Timeout rete dopo 60s. Controlla la connessione e riprova tra 30s.',
  'ARCHIBALD_UNREACHABLE': 'Archibald non risponde. Riprova tra 1 minuto o controlla che Archibald sia accessibile.',
  'CUSTOMER_NOT_FOUND': 'Cliente non trovato. Verifica che il cliente esista in Archibald.',
  'PRODUCT_NOT_FOUND': 'Articolo non trovato. Verifica il codice articolo.',
  'VALIDATION_ERROR': 'Dati non validi. Controlla i campi e riprova.',
  'LOGIN_FAILED': 'Login fallito. Verifica credenziali Archibald.',
  'SESSION_EXPIRED': 'Sessione scaduta. Riprova, verr√† eseguito un nuovo login.',
};

function getHumanReadableError(error: string): string {
  // Check if error matches known patterns
  for (const [key, message] of Object.entries(ERROR_MESSAGES)) {
    if (error.includes(key) || error.includes(key.toLowerCase())) {
      return message;
    }
  }

  // Fallback to generic message with original error (sanitized)
  return `Errore durante la creazione: ${error}. Riprova o contatta il supporto.`;
}
```

**Acceptance criteria**:
- OrderForm calls startTracking() when order submitted
- Global badge appears on OrderForm page (bottom-right, fixed position)
- Badge hidden automatically when navigating away from OrderForm
- Badge reappears on ALL pages when order completes (notification)
- Agent can navigate freely without badge obstructing content
- Success toast appears when order complete (from global event)
- Error toast shows human-readable message with action
- Badge auto-dismisses 5s after completion notification
- Form persists - no reset (agent can submit next immediately)
- TypeScript compiles without errors
    </instructions>
  </task>

  <task type="checkpoint:human-verify">
    <description>Verify end-to-end progress tracking and toast notifications</description>
    <instructions>
**Manual test procedure**:

1. **Start full stack**:
```bash
# Terminal 1: Backend
cd archibald-web-app/backend
npm run dev

# Terminal 2: Frontend
cd archibald-web-app/frontend
npm run dev
```

2. **Open browser**: Navigate to http://localhost:5173

3. **Create test order**:
- Select customer: "Test Cliente"
- Add article: Code "11.011", Quantity 1
- Click "Crea Ordine"

4. **Observe global badge**:
- Badge appears bottom-right immediately after submission
- Shows: ‚è≥ icon, "Ordine in elaborazione - <customer name>"
- Shows current step + time remaining
- Toast appears: "Ordine inviato! Puoi continuare a lavorare."

5. **Test adaptive visibility**:
- Badge is visible on order form page during processing
- Navigate to customers page ‚Üí **badge disappears** (to not obstruct)
- Navigate to products page ‚Üí **badge still hidden**
- Navigate to settings ‚Üí **badge still hidden**
- Navigate back to order form ‚Üí **badge reappears** with current progress
- State persists (WebSocket still connected, tracking continues)

6. **Test multitasking workflow**:
- Submit order on OrderForm ‚Üí badge visible
- Navigate to customers page ‚Üí badge hidden, agent can work freely
- Browse customers without badge obstructing content
- Search products without badge in the way
- Work in any page without visual interruption

7. **Verify completion notification**:
- While on customers page (badge hidden), wait for order to complete
- After ~82s, **badge suddenly appears**: ‚úÖ "Ordine completato"
- Badge now visible on customers page (notification mode)
- Toast notification appears: "‚úÖ Ordine #<ID> creato con successo!"
- Badge auto-dismisses after 5 seconds
- Toast auto-dismisses after 5s
- Navigate back to OrderForm ‚Üí form ready for next order

8. **Test error handling** (simulate network failure):
- Disconnect WiFi after submitting order
- Badge shows ‚ùå icon
- Toast appears: "Errore di connessione WebSocket. Controlla la connessione di rete."
- Badge persists (doesn't auto-dismiss on error)
- Agent can dismiss manually or retry

9. **Test badge visibility logic**:
- Submit order on OrderForm ‚Üí badge appears
- Navigate to customers page ‚Üí badge **disappears**
- Navigate to products page ‚Üí badge **still hidden**
- Navigate back to OrderForm ‚Üí badge **reappears** with updated progress
- Verify state persisted (same step, updated time remaining)
- Navigate away again ‚Üí badge hides again
- Wait for completion on different page ‚Üí badge **reappears** to notify
- Verify badge appears on ANY page when complete (not just OrderForm)

**Success criteria**:
- ‚úÖ Global badge appears bottom-right when order submitted (on OrderForm page)
- ‚úÖ Badge shows: status icon, customer name, current step, time remaining
- ‚úÖ Badge **hidden** when navigating away from OrderForm during processing
- ‚úÖ Badge **reappears** on OrderForm if user navigates back
- ‚úÖ Badge **reappears everywhere** when order completes (notification mode)
- ‚úÖ State persists during navigation (WebSocket continues tracking even when badge hidden)
- ‚úÖ Agent can browse customers, products freely without badge obstructing content
- ‚úÖ Agent can work without visual interruption while order processes in background
- ‚úÖ Success toast appears when complete (on any page)
- ‚úÖ Badge auto-dismisses 5s after completion
- ‚úÖ Error badge appears on all pages (notification mode)
- ‚úÖ Error toast shows human-readable message
- ‚úÖ Form persists after success (agent can submit next immediately)
- ‚úÖ No console errors or WebSocket connection issues
- ‚úÖ Badge z-index ensures visibility when shown

**If verification fails**:
- Check browser console for WebSocket connection errors
- Verify backend WebSocket endpoint is running
- Ensure jobId is correctly passed from form submission
- Check network tab for WebSocket frames
- Verify toast messages match expected text
    </instructions>
  </task>
</tasks>

<verification>
## Automated Checks
- TypeScript compilation: `npm run typecheck` (frontend + backend)
- No new ESLint errors: `npm run lint` (frontend)
- Existing tests pass: `npm test` (frontend)

## Manual Verification
- Global badge appears on OrderForm page when order submitted
- Badge hidden automatically when navigating to other pages
- Badge reappears when navigating back to OrderForm (with updated state)
- Badge reappears everywhere when order completes (notification mode)
- Form remains accessible while order processes
- Agent can navigate freely without badge obstructing content
- Agent can work on customers/products pages without visual interruption
- Success toast appears with order ID (on any page, regardless of badge visibility)
- Badge reappears + auto-dismisses after completion
- Error badge appears on all pages (notification mode)
- Error toast shows actionable message
- Form persists after success (no auto-reset)
- WebSocket connection survives page changes (tracks even when badge hidden)

## Performance Check
- WebSocket connection latency < 500ms
- UI updates smooth (no flicker or lag)
- Toast animations perform well (60fps)
- No memory leaks from WebSocket subscriptions
</verification>

<success_criteria>
- [ ] OrderTrackingContext manages global state (App-level)
- [ ] GlobalOrderBadge has adaptive visibility:
  - [ ] Visible on OrderForm page during processing
  - [ ] Hidden on other pages during processing
  - [ ] Visible everywhere when complete/error (notification)
- [ ] Badge shows: status icon, customer name, current step, time remaining
- [ ] State persists during navigation (even when badge hidden)
- [ ] WebSocket connection managed globally (survives navigation, tracks in background)
- [ ] Agent can navigate anywhere without badge obstructing content
- [ ] Agent can work freely on any page while order processes silently
- [ ] Toast notification system with success/error/info types
- [ ] OrderForm calls startTracking() on submission
- [ ] Success toast appears on any page when order completes
- [ ] Badge reappears on completion for notification, then auto-dismisses 5s
- [ ] Human-readable error messages with actionable guidance
- [ ] TypeScript compiles without errors
- [ ] Manual test confirms adaptive behavior (form ‚Üí badge ‚Üí navigate ‚Üí badge hides ‚Üí complete ‚Üí badge reappears ‚Üí auto-dismiss)
</success_criteria>

<output>
## Files Created
- `archibald-web-app/frontend/src/contexts/OrderTrackingContext.tsx` - Global order state + WebSocket
- `archibald-web-app/frontend/src/components/GlobalOrderBadge.tsx` - Global persistent badge
- `archibald-web-app/frontend/src/components/Toast.tsx` - Toast notification component
- `archibald-web-app/frontend/src/hooks/useToast.ts` - Toast management hook

## Files Modified
- `archibald-web-app/frontend/src/App.tsx` - Wrapped with OrderTrackingProvider + GlobalOrderBadge
- `archibald-web-app/frontend/src/components/OrderForm.tsx` - Integrated global tracking
- `archibald-web-app/frontend/src/App.css` - Added badge and toast styles

## Documentation
- SUMMARY.md with UX enhancement details
- Screenshots of progress tracker and toast notifications

## Phase Complete
Phase 5 objectives achieved:
- ‚úÖ Real-time progress tracking with step-by-step visibility (on OrderForm page)
- ‚úÖ **Global background mode** - agent can navigate anywhere while order processes
- ‚úÖ **Adaptive badge visibility** - shown only on OrderForm during processing, hidden elsewhere to not obstruct
- ‚úÖ **Notification mode** - badge reappears everywhere when complete/error
- ‚úÖ State persists across ALL pages even when badge hidden (WebSocket tracks in background)
- ‚úÖ Time remaining estimate (~45s-82s) visible on OrderForm
- ‚úÖ Discrete banner notification on completion (reappears + auto-dismiss after 5s)
- ‚úÖ Non-invasive toast notifications
- ‚úÖ Human-readable error messages
- ‚úÖ Form remains functional - agent can prepare next order immediately
- ‚úÖ NO changes to existing bot, BullMQ, or PriorityManager infrastructure

**User vision honored**:
- "non dobbiamo rovinare quello che abbiamo gi√† costruito" - all existing infrastructure preserved
- "navigare in altre parti dell'app senza intaccare il lavoro del bot" - WebSocket tracks silently in background
- "il badge non deve limitare la sua user experience se pu√≤ coprire info o aree" - adaptive visibility, hidden on non-OrderForm pages
- "innvisibile e apparire solo all'avviso di ordine completo" - badge hidden during processing on other pages, reappears to notify
- "se si resta nella pagina dell'elaborazione resta visibile" - badge visible on OrderForm with full real-time info
- "essere solo avvisato con un banner discreto e che poi scompare" - toast + badge reappears briefly + auto-dismiss after 5s
</output>
