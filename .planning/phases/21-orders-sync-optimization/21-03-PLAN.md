---
phase: 21-orders-sync-optimization
plan: 03
type: execute
---

<objective>
Implement incremental sync strategy for orders with 3-page limit.

Purpose: Reduce sync time via delta sync (most recent orders only).
Output: Delta sync mode reducing sync time by 80-90% for incremental runs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/phases/18-customers-sync-optimization/18-03-PLAN.md

**Implementation**: Apply identical pattern from Phases 18-03, 19-03, 20-03 to OrderHistoryService.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add syncMode parameter to syncOrders</name>
  <files>
    archibald-web-app/backend/src/order-history-service.ts
  </files>
  <action>
    Apply Phase 18-03 pattern (syncMode: 'full' | 'incremental' | 'auto', 3-page limit for incremental).
  </action>
  <verify>
    Incremental mode limits to 3 pages
  </verify>
  <done>
    syncMode parameter added. TypeScript passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update retry and auto-sync wrappers</name>
  <files>
    archibald-web-app/backend/src/order-history-service.ts
  </files>
  <action>
    Add forceFullSync() and forceIncrementalSync() methods.
  </action>
  <verify>
    Manual sync methods functional
  </verify>
  <done>
    Manual sync methods added. TypeScript passes.
  </done>
</task>

</tasks>

<success_criteria>
- Incremental sync (3-page limit)
- Auto mode (7-day threshold)
- Manual control methods
- 80-90% time reduction for incremental
- Consistent with Phases 18-03, 19-03, 20-03
</success_criteria>

<output>
Create `.planning/phases/21-orders-sync-optimization/21-03-SUMMARY.md`
</output>
