---
phase: 21-orders-sync-optimization
plan: 05
type: execute
---

<objective>
Apply identified performance optimizations and verify all order sync modes.

Purpose: Implement optimization recommendations from 21-01 analysis.
Output: Optimized sync performance (30-40% faster), all sync modes functional.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/phases/21-orders-sync-optimization/ANALYSIS.md
@.planning/phases/18-customers-sync-optimization/18-05-PLAN.md

**Implementation**: Apply same optimizations as Phases 18-05, 19-05, 20-05.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply page navigation optimizations</name>
  <files>
    archibald-web-app/backend/src/order-history-service.ts
  </files>
  <action>
    Replace networkidle2 with domcontentloaded + explicit selectors.
    Remove unnecessary setTimeout delays.
  </action>
  <verify>
    Navigation phase faster
  </verify>
  <done>
    Navigation optimized. TypeScript passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete order sync optimization with all modes</what-built>
  <how-to-verify>
    1. Start backend and frontend
    2. Test full sync performance (verify 30-40% improvement)
    3. Test incremental sync (verify 3-page limit, 80-90% faster)
    4. Test auto mode (verify intelligent selection)
    5. Test retry logic (simulate failures, verify 3 attempts)
    6. Test health monitoring (GET /api/sync/orders/health)
    7. Test background auto-sync
    8. Test frontend dropdown UI (Auto, Full, Incremental modes)
    9. Verify all orders synced correctly
    10. Check performance logs vs baseline

    Success: Full sync 30-40% faster, incremental 80-90% faster, all modes functional.
  </how-to-verify>
  <resume-signal>Type "approved" to continue</resume-signal>
</task>

</tasks>

<success_criteria>
- Performance optimizations applied
- Full sync 30-40% faster
- Incremental sync 80-90% faster
- All sync modes functional
- User verification passed
- Consistent with Phases 18-05, 19-05, 20-05
</success_criteria>

<output>
Create `.planning/phases/21-orders-sync-optimization/21-05-SUMMARY.md` with performance comparison table.
</output>
