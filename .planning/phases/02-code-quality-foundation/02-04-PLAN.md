---
phase: 02-code-quality-foundation
plan: 04
type: execute
---

<objective>
Remove type any from database layer and type definition files.

Purpose: Establish strict typing in data layer for type safety and better IDE support.
Output: customer-db, product-db, schemas, and types files with proper TypeScript types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-quality-foundation/02-03-SUMMARY.md
@.planning/codebase/CONVENTIONS.md
@src/customer-db.ts
@src/product-db.ts
@src/schemas.ts
@src/types.ts

**Tech stack:**
- TypeScript 5.3.3 with strict mode enabled
- better-sqlite3 for database
- zod for schema validation

**Conventions:**
- PascalCase for interfaces/types
- No `I` prefix on interfaces
- Explicit return types on functions

**Current state:**
- 24 type any instances in backend/src/
- Database layer needs proper typing first (foundation for services)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add proper types to customer-db.ts and product-db.ts</name>
  <files>src/customer-db.ts, src/product-db.ts</files>
  <action>
For customer-db.ts:
- Replace any with proper types for:
  - Database row types (Customer interface if not exists)
  - Query parameters (string, number, explicit unions)
  - Return types (Customer, Customer[], Customer | null)
- Add return types to all methods
- If better-sqlite3 methods return any, create type wrappers

For product-db.ts:
- Replace any with proper types for:
  - Product interface (if not exists)
  - Price interface (if not exists)
  - Query parameters with explicit types
  - Return types on all methods
- Ensure all database operations are properly typed

Use existing types from types.ts if available, create new ones if needed.
DO NOT change database logic, only add/improve types.
  </action>
  <verify>grep ": any" src/customer-db.ts src/product-db.ts returns empty</verify>
  <done>No type any in database files, all methods have explicit return types</done>
</task>

<task type="auto">
  <name>Task 2: Add proper types to schemas.ts and types.ts</name>
  <files>src/schemas.ts, src/types.ts</files>
  <action>
For schemas.ts:
- Review all zod schemas
- Replace any with z.unknown() or proper zod types (z.string(), z.number(), z.object(), etc.)
- Ensure schema inference types are properly exported
- Add explicit types for schema validation results

For types.ts:
- Review all type definitions and interfaces
- Replace any with proper types:
  - Use unknown for truly dynamic data
  - Use specific types where structure is known
  - Use unions for multiple possibilities
  - Use generics where appropriate
- Add JSDoc comments for complex types

DO NOT change validation logic or type semantics, only strengthen typing.
  </action>
  <verify>grep ": any" src/schemas.ts src/types.ts returns empty</verify>
  <done>No type any in schemas or types files, all types properly defined</done>
</task>

<task type="auto">
  <name>Task 3: TypeScript strict verification and any count check</name>
  <files>N/A</files>
  <action>
Run verification:
1. TypeScript compilation with strict mode: `npx tsc --noEmit` (must pass)
2. Count remaining any: `grep -r ": any" src/ --exclude="*.backup*" | wc -l`
3. List files with remaining any: `grep -r ": any" src/ --exclude="*.backup*" | cut -d: -f1 | sort -u`
4. Verify no regressions in existing functionality

Document count of remaining type any instances (should be in services/bot files, not data layer).
Database layer (customer-db, product-db, schemas, types) should have 0 type any.
  </action>
  <verify>TypeScript compiles, grep shows 0 type any in database layer files</verify>
  <done>Database layer fully typed, TypeScript strict mode passes, remaining any documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] No type any in customer-db.ts
- [ ] No type any in product-db.ts
- [ ] No type any in schemas.ts
- [ ] No type any in types.ts
- [ ] TypeScript compilation passes with strict mode
- [ ] Remaining any count documented
</verification>

<success_criteria>
- All 3 tasks completed
- Database layer fully typed (0 type any)
- Type definitions strengthened
- TypeScript strict mode passes
- No functionality regressions
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-quality-foundation/02-04-SUMMARY.md`:

# Phase 2 Plan 04: Remove type any in Database Layer

**Database layer fully typed - [X] type any instances removed from data layer**

## Accomplishments

- Added proper types to customer-db.ts
- Added proper types to product-db.ts
- Strengthened types in schemas.ts
- Improved type definitions in types.ts
- TypeScript strict mode verification passes

## Files Created/Modified

- `src/customer-db.ts` - Full typing added
- `src/product-db.ts` - Full typing added
- `src/schemas.ts` - Type any removed
- `src/types.ts` - Type definitions strengthened

## Decisions Made

[Document any decisions about type design or unknowns vs any]

## Issues Encountered

[Document any problems and resolutions, or "None"]

## Next Step

Ready for 02-05-PLAN.md (Remove type any in Services & Bot)
</output>
