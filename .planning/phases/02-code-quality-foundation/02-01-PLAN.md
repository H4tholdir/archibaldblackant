---
phase: 02-code-quality-foundation
plan: 01
type: execute
---

<objective>
Setup Vitest testing framework with first smoke test and testing conventions.

Purpose: Establish testing foundation for all future tests, verify framework works correctly.
Output: Working Vitest configuration, first passing test, testing conventions documented.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STACK.md

**Tech stack available:**
- Vitest 1.2.1 already in package.json
- TypeScript 5.3.3
- No vitest.config.ts yet (uses defaults)

**Established patterns:**
- Test files: *.test.ts alongside source
- camelCase for functions
- PascalCase for classes

**From Phase 1:**
- Security fixes complete
- Codebase ready for testing work
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create vitest.config.ts and first smoke test</name>
  <files>vitest.config.ts, src/config.test.ts</files>
  <action>
Create vitest.config.ts in backend root with:
- test.globals: true (no import { describe, it, expect } needed)
- test.environment: 'node'
- test.coverage.provider: 'v8'
- test.coverage.reporter: ['text', 'html']

Create src/config.test.ts as first smoke test:
- Import config from './config'
- Test that config object exists
- Test that config.archibald.url is defined
- Test that config.server.port is a number
Keep it simple - just verify config loads correctly.
  </action>
  <verify>npm test runs and shows 1 test passing</verify>
  <done>vitest.config.ts exists, config.test.ts passes, npm test works</done>
</task>

<task type="auto">
  <name>Task 2: Add test scripts to package.json</name>
  <files>package.json</files>
  <action>
Update package.json scripts section:
- Modify existing "test" script to: "vitest"
- Add "test:watch": "vitest --watch"
- Add "test:coverage": "vitest --coverage"
- Keep existing manual test scripts (test:login, test:order, test:queue) for backward compatibility

Verify the test command runs Vitest with the new config.
  </action>
  <verify>npm test runs vitest, npm run test:watch starts watch mode, npm run test:coverage works</verify>
  <done>All test scripts functional, backward compatibility maintained</done>
</task>

<task type="auto">
  <name>Task 3: Document testing conventions in TESTING.md</name>
  <files>.planning/codebase/TESTING.md</files>
  <action>
Update .planning/codebase/TESTING.md to reflect new setup:
- Update "Test Framework" section with vitest.config.ts location
- Update "Run Commands" section with new npm scripts
- Add "Test Structure" section with conventions:
  - *.test.ts files alongside source
  - describe(className/functionName) for grouping
  - it('should behavior') for test cases
  - Mock external dependencies (Puppeteer, Redis, SQLite)
- Update "Test Coverage Gaps" to note framework is now ready
- Keep existing manual test scripts documentation

Mark this as "Updated: 2026-01-12 after Vitest setup".
  </action>
  <verify>TESTING.md accurately reflects new setup, conventions are clear</verify>
  <done>Documentation updated, conventions documented, date stamp added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm test runs and passes with 1 test
- [ ] vitest.config.ts exists and is valid
- [ ] Test scripts work (test, test:watch, test:coverage)
- [ ] TESTING.md updated with conventions
</verification>

<success_criteria>
- All 3 tasks completed
- Vitest framework working
- First smoke test passes
- Testing conventions documented
- No errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/02-code-quality-foundation/02-01-SUMMARY.md`:

# Phase 2 Plan 01: Setup Vitest Testing Framework

**Vitest framework configured and operational - first smoke test passing**

## Accomplishments

- Created vitest.config.ts with node environment and coverage
- First smoke test (config.test.ts) passing
- Test scripts added to package.json
- Testing conventions documented in TESTING.md

## Files Created/Modified

- `vitest.config.ts` - Vitest configuration
- `src/config.test.ts` - First smoke test
- `package.json` - Updated test scripts
- `.planning/codebase/TESTING.md` - Updated conventions

## Decisions Made

[Document any decisions made during implementation]

## Issues Encountered

[Document any problems and resolutions, or "None"]

## Next Step

Ready for 02-02-PLAN.md (Replace console.log in Core Services)
</output>
