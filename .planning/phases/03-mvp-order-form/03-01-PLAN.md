---
phase: 03-mvp-order-form
plan: 01
type: execute
---

<objective>
Research Archibald ERP UI structure for package types and multipliers, and document findings for implementation.

Purpose: Understand how package types (confezione) work in Archibald order creation form to implement proper selection UI and multiplier validation in our form.
Output: Discovery document with UI structure, selectors, data flow, and validation rules for package/multiplier fields.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-code-quality-foundation/02-08-SUMMARY.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/ARCH ITECTURE.md
@archibald-web-app/backend/src/archibald-bot.ts
@archibald-web-app/backend/src/product-sync-service.ts
@archibald-web-app/backend/src/product-db.ts
@archibald-web-app/frontend/src/components/OrderForm.tsx
@archibald-web-app/frontend/src/types/order.ts

**Tech stack available:**
- Backend: TypeScript 5.3.3, Puppeteer, Express, better-sqlite3
- Frontend: React 19, TypeScript, Vite
- Testing: Vitest with 64 tests passing

**Current state:**
- OrderForm component exists with customer/product autocomplete
- OrderItem interface has articleCode, quantity, price, discount
- Product database has packageContent, minQty, multipleQty fields
- archibald-bot.ts fills order form but doesn't handle package type selection yet

**Need to discover:**
- How does Archibald UI present package type options (dropdown, radio, etc.)?
- What HTML/DevExpress selectors identify package type fields?
- What's the data flow: article → available packages → multiplier rules?
- Are there validation rules enforced by Archibald (min order, multiples)?
</context>

<tasks>

<task type="auto">
  <name>Task 1: Explore Archibald order creation UI for package type fields</name>
  <files>N/A (exploration task)</files>
  <action>
Investigate Archibald ERP order creation form structure for package/multiplier fields:

1. **Search existing code for package-related selectors:**
   - Grep archibald-bot.ts for any PACKAGETYPE, PACKTYPE, or related DevExpress field IDs
   - Check product-sync-service.ts to see how packageContent is scraped
   - Review any commented-out code that might reference package selection

2. **Analyze product database schema:**
   - Document what packageContent, minQty, multipleQty represent
   - Check if products have multiple package type options or single value
   - Look for patterns in actual data (if data/ has populated DB)

3. **Infer UI structure from existing automation:**
   - Review how article selection works in archibald-bot.ts (lines ~1600-1900)
   - See if there are hidden fields or dropdowns that get populated after article selection
   - Check for any DevExpress combo boxes or radio buttons near quantity field

4. **Document findings:**
   - Create 03-01-DISCOVERY.md with:
     - UI structure hypothesis (dropdown, radio, automatic)
     - Likely HTML/DevExpress selectors
     - Data flow diagram (article → packages → quantity rules)
     - Validation rules to implement
     - Open questions requiring manual Archibald inspection

5. **Identify what's NOT in code:**
   - Document what can only be discovered by manual Archibald login inspection
   - List specific UI elements to check when user has Archibald access
   - Prepare checkpoint for user verification

DO NOT attempt to implement anything yet - pure discovery only.
DO NOT assume structure - document what's observable and what's uncertain.
  </action>
  <verify>03-01-DISCOVERY.md exists with UI structure analysis, selectors, data flow</verify>
  <done>Discovery document complete with findings, hypotheses, and open questions documented</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Discovery document with Archibald UI structure analysis</what-built>
  <how-to-verify>
Read 03-01-DISCOVERY.md and verify:
1. UI structure hypothesis makes sense based on ERP patterns
2. Selectors identified are plausible DevExpress field names
3. Data flow matches how product/package systems typically work
4. Open questions are clear and answerable with Archibald access
5. Nothing seems overlooked (package types, multipliers, validation)

If Archibald access is available:
1. Log into Archibald ERP test environment
2. Navigate to order creation form
3. Select a product and observe:
   - Does a package type field appear?
   - What are the available options?
   - How does it affect quantity validation?
4. Compare observations to discovery document
5. Note any discrepancies or missing details
  </how-to-verify>
  <resume-signal>Type "approved" if discovery is complete, or describe missing findings to add</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Finalize discovery and document implementation approach</name>
  <files>.planning/phases/03-mvp-order-form/03-01-DISCOVERY.md</files>
  <action>
Based on verification feedback, update discovery document:

1. **Incorporate user observations:**
   - Add confirmed UI structure details from manual inspection
   - Document actual selectors found in Archibald DOM
   - Record exact package type options and their data format

2. **Document implementation approach:**
   - How to extend Product interface for package type options
   - How to extend OrderItem to include selected package type
   - Where package selection UI fits in OrderForm component
   - How to validate quantity against multiplier rules

3. **List dependencies for next plans:**
   - Backend schema changes needed (if any)
   - Frontend component additions
   - Validation logic to implement
   - archibald-bot.ts automation additions

4. **Create task breakdown for subsequent plans:**
   - Rough outline of 03-02 through 03-07 based on findings
   - Dependencies between plans
   - Estimated complexity for each

This provides the foundation for planning the remaining Phase 3 work.
  </action>
  <verify>DISCOVERY.md has implementation approach section with concrete next steps</verify>
  <done>Discovery complete, implementation roadmap documented, ready for 03-02 planning</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] 03-01-DISCOVERY.md exists with comprehensive findings
- [ ] UI structure documented (confirmed or hypothesized)
- [ ] Selectors identified for package type fields
- [ ] Data flow understood (article → packages → multipliers)
- [ ] Validation rules documented
- [ ] Implementation approach outlined
- [ ] Next plans can be created based on findings
</verification>

<success_criteria>
- All 3 tasks completed
- Discovery document comprehensive and actionable
- User verified findings match Archibald reality (if access available)
- Clear understanding of package/multiplier system
- Implementation approach documented for subsequent plans
- No assumptions left unverified
</success_criteria>

<output>
After completion, create `.planning/phases/03-mvp-order-form/03-01-SUMMARY.md`:

# Phase 3 Plan 01: Research Archibald Package/Multiplier UI

**Archibald package type system discovered and documented - implementation approach defined**

## Accomplishments

- Analyzed existing code for package-related patterns
- Documented product database schema (packageContent, minQty, multipleQty)
- Created comprehensive discovery document
- Verified findings against Archibald UI (if accessible)
- Defined implementation approach for subsequent plans

## Files Created/Modified

- `.planning/phases/03-mvp-order-form/03-01-DISCOVERY.md` - Complete UI structure analysis

## Decisions Made

[Document key findings about package type system: dropdown/radio/automatic, validation rules, etc.]

## Issues Encountered

[Document any ambiguities or areas requiring further investigation, or "None"]

## Next Step

Ready to plan 03-02 (Make price field read-only) based on discovery findings
</output>
