---
phase: 10-order-history
plan: 01
type: execute
---

<objective>
Practical discovery of Archibald ERP order history UI to map selectors, navigation flows, and available data fields.

Purpose: Phase 10 requires scraping order history from Archibald. Before implementing scrapers, we must understand the UI structure, identify DevExpress selectors, and document what data is available.
Output: Discovery documentation with screenshots, HTML structure, selector mappings, and navigation flows ready for implementation in Plans 10-02 through 10-04.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-order-history/10-CONTEXT.md
@.planning/phases/10-order-history/10-RESEARCH.md

**Key Context from RESEARCH.md:**
- Reuse existing DevExpress helper methods (6 methods from Phase 3.08)
- Multi-user session management via BrowserPool (Phase 6)
- Pagination patterns from customer-sync-service.ts
- Banking app timeline UI patterns (Phase 8)

**Key Context from CONTEXT.md:**
- Banking app style timeline (Intesa/UniCredit reference)
- Essential features: states, details, documents, filters (all equally important)
- Order states: in lavorazione, evaso, spedito
- Tracking: Badge "Tracking disponibile" when available
- Documents: "Vedi documenti" button for fatture/DDT

**Tech Stack Available:**
- Puppeteer ~21.x (browser automation)
- DevExpress XAF UI (dynamic IDs, text-based selection)
- BrowserContext pooling (Phase 6 multi-user sessions)

**Established Patterns:**
- DevExpress helpers: waitForDevExpressDropdown, selectDevExpressDropdownByText, waitForDevExpressTableLoad, clickDevExpressTableRow, getDevExpressTableCellValue
- Session-scoped scraping: browserPool.acquireContext(userId)
- Text-based element identification (DevExpress IDs are dynamic)

**Constraining Decisions:**
- Phase 6: Order history must be per-user (session isolation)
- Phase 3.08: Use text content for element identification (not dynamic IDs)
- Phase 4.1-01: Use PriorityManager to avoid race conditions with sync services
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Navigate to order history section in Archibald and capture screenshots</action>
  <instructions>
    I need you to manually explore Archibald ERP to locate the order history section:

    1. Login to Archibald (https://4.231.124.90/Archibald) with your credentials
    2. Navigate to the "Ordini" menu (we know this exists from Phase 3.08)
    3. Look for submenu or link to "Storico ordini", "Lista ordini", or similar
    4. Take screenshots of:
       - Order list view (main table with all orders)
       - An expanded/detailed view of a single order (if clicking a row opens detail)
       - Any pagination controls (if order list spans multiple pages)
       - Filter/search controls (if visible)
    5. Save screenshots to `.planning/phases/10-order-history/screenshots/`

    Create the directory first if needed:
    mkdir -p .planning/phases/10-order-history/screenshots/

    Screenshot naming convention:
    - 01-order-list-main.png (main order list table)
    - 02-order-detail-expanded.png (detail view of single order)
    - 03-pagination-controls.png (if pagination exists)
    - 04-filter-controls.png (if filters/search exist)
    - 05-tracking-info.png (if you can find tracking on a shipped order)
    - 06-documents-section.png (if you can find invoices/DDT links)
  </instructions>
  <verification>Screenshots exist in .planning/phases/10-order-history/screenshots/</verification>
  <resume-signal>Type "done" when screenshots are captured, or "not-found" if you cannot locate order history section</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Inspect HTML structure and map DevExpress selectors</name>
  <files>.planning/phases/10-order-history/UI-SELECTORS.md</files>
  <action>
    Based on the screenshots provided, create UI-SELECTORS.md documenting:

    1. **Order List Table:**
       - Table container selector (likely `.dxgvControl` like customer sync)
       - Row selector (likely `.dxgvDataRow`)
       - Cell selectors for each column (ID, date, customer, total, status)
       - Example: Identify which `.dxgv` index corresponds to which field

    2. **Navigation to Detail:**
       - How to access order detail (click row? button? link?)
       - Selector for clickable element
       - Wait condition after click (modal? new page? expanded row?)

    3. **Order Detail Fields:**
       - Article list table selector
       - Fields: article name/code, quantity, unit price, subtotal
       - Customer info location
       - Order notes location

    4. **Status Timeline:**
       - Where status history appears (table? list? timeline UI?)
       - Fields: status name, timestamp

    5. **Tracking Information:**
       - Where tracking appears (if visible in screenshots)
       - Fields: courier name, tracking number
       - Condition: when is tracking visible vs empty?

    6. **Documents Section:**
       - Where invoice/DDT links appear
       - Selector for document links
       - Link format (URL pattern, download trigger)

    7. **Pagination:**
       - Next page button selector (if exists)
       - Current page indicator
       - Total pages/records count

    Use markdown format similar to `.planning/archibald-ui-selectors.md` from Phase 3.08.
    Include notes on DevExpress dynamic IDs (use text content instead).
    Mark fields as "UNKNOWN - needs runtime inspection" if not visible in screenshots.
  </action>
  <verify>cat .planning/phases/10-order-history/UI-SELECTORS.md shows complete selector documentation</verify>
  <done>UI-SELECTORS.md created with all identified selectors, navigation flows, and field mappings</done>
</task>

<task type="auto">
  <name>Task 3: Document discovery findings and data schema</name>
  <files>.planning/phases/10-order-history/10-01-SUMMARY.md</files>
  <action>
    Create SUMMARY.md documenting discovery findings:

    1. **Navigation Path:**
       - Exact menu/submenu sequence to reach order history
       - URL pattern (if URL changes)

    2. **Available Data Fields:**
       - Order list fields: ID, date, customer, total, status (confirmed/missing)
       - Order detail fields: articles, quantities, prices, customer info, notes
       - Status timeline: status names, timestamps
       - Tracking: courier, number (when available)
       - Documents: invoice links, DDT links (when available)

    3. **UI Patterns Identified:**
       - DevExpress table for list (yes/no)
       - Pagination present (yes/no, pattern)
       - Detail view type (modal/page/expanded row)
       - Filter controls (customer search, date range, status filter)

    4. **Reusable Patterns from Prior Phases:**
       - Which DevExpress helpers apply (e.g., waitForDevExpressTableLoad)
       - Pagination pattern similarity to customer-sync
       - Session management via BrowserPool

    5. **Open Questions / Blockers:**
       - Any fields from CONTEXT.md requirements not found in UI
       - Any unclear navigation flows
       - Any fields requiring additional user input or testing

    6. **Next Steps:**
       - Ready for Plan 10-02 (Order List Scraper)
       - Blockers that must be resolved first

    Include references to screenshot files for key findings.
  </action>
  <verify>cat .planning/phases/10-order-history/10-01-SUMMARY.md shows complete discovery documentation</verify>
  <done>Discovery complete with navigation paths, selector mappings, data schema, and readiness for implementation plans</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Screenshots captured and saved to .planning/phases/10-order-history/screenshots/
- [ ] UI-SELECTORS.md created with DevExpress selectors and navigation flows
- [ ] 10-01-SUMMARY.md documents all findings and confirms readiness for Plan 10-02
- [ ] All required fields from CONTEXT.md mapped to Archibald UI (or marked as unclear)
</verification>

<success_criteria>
- Screenshots provide clear view of order list, detail, and available data
- UI-SELECTORS.md maps all necessary selectors for implementation
- Discovery findings document navigation paths and data schema
- Open questions identified for resolution before continuing
- Phase 10 implementation plans (10-02 through 10-07) can proceed with confidence
</success_criteria>

<output>
After completion, create `.planning/phases/10-order-history/10-01-SUMMARY.md`:

# Phase 10 Plan 01: Archibald Order History UI Discovery Summary

**Practical discovery of Archibald order history UI completed with selector mappings and navigation flows documented.**

## Accomplishments

- Navigated to order history section in Archibald
- Captured screenshots of order list, detail view, and controls
- Mapped DevExpress selectors for order list table and detail fields
- Documented navigation flows and data schema
- Identified reusable patterns from prior phases

## Files Created/Modified

- `.planning/phases/10-order-history/screenshots/*.png` - UI screenshots
- `.planning/phases/10-order-history/UI-SELECTORS.md` - Selector mappings
- `.planning/phases/10-order-history/10-01-SUMMARY.md` - Discovery findings

## Decisions Made

[Key decisions about navigation approach, selector strategy, or data extraction approach]

## Issues Encountered

[Any fields not found, unclear navigation, or blockers discovered]

## Next Step

Ready for Plan 10-02 (Order List Scraper Implementation) with complete UI understanding.
</output>
