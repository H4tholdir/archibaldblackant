---
phase: 10-order-history
plan: 07
type: execute
---

<objective>
Create OrderHistory page with timeline layout, filters UI, and API integration with loading/error states.

Purpose: Assemble all components into complete order history feature - timeline display, search/filters, API calls, and user interactions for the banking app experience.
Output: Complete OrderHistory page accessible from app navigation, with all CONTEXT.md requirements implemented.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-order-history/10-CONTEXT.md
@.planning/phases/10-order-history/10-RESEARCH.md
@.planning/phases/10-order-history/10-05-SUMMARY.md
@.planning/phases/10-order-history/10-06-SUMMARY.md

**CONTEXT.md Requirements:**
- Timeline cronologica con ordini recenti in alto
- Raggruppamento temporale (Oggi, Settimana, Mese, Vecchi)
- Espansione inline delle card
- Filtri: customer search, date/period, order status (all equally essential)
- Banking app UX (Intesa/UniCredit)

**Available Components (Plan 10-06):**
- OrderCard (collapsed/expanded)
- OrderTimeline (status history)
- groupOrdersByPeriod() utility

**API Endpoints (Plan 10-05):**
- GET /api/orders/history?customer=X&dateFrom=Y&dateTo=Z&status=W
- GET /api/orders/:id

**Key Files:**
@archibald-web-app/frontend/src/components/OrderCard.tsx
@archibald-web-app/frontend/src/components/OrderTimeline.tsx
@archibald-web-app/frontend/src/utils/orderGrouping.ts
@archibald-web-app/frontend/src/App.tsx (add navigation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OrderHistory page with timeline layout</name>
  <files>archibald-web-app/frontend/src/pages/OrderHistory.tsx, archibald-web-app/frontend/src/pages/OrderHistory.module.css</files>
  <action>
    Create OrderHistory page component:

    1. **Component structure:**
       ```typescript
       export function OrderHistory() {
         const [orders, setOrders] = useState<Order[]>([]);
         const [loading, setLoading] = useState(true);
         const [error, setError] = useState<string | null>(null);
         const [expandedOrderId, setExpandedOrderId] = useState<string | null>(null);
         const [filters, setFilters] = useState<OrderFilters>({
           customer: '',
           dateFrom: '',
           dateTo: '',
           status: ''
         });

         // Fetch orders on mount and when filters change
         useEffect(() => {
           fetchOrders();
         }, [filters]);

         // Implementation
       }
       ```

    2. **API integration:**
       - Fetch orders from GET /api/orders/history with JWT token (localStorage.getItem('archibald_jwt'))
       - Include filter query parameters when set
       - Handle loading state while fetching
       - Handle error state (network error, 401, 500)
       - When expanding card, fetch detail from GET /api/orders/:id if not already loaded

    3. **Timeline rendering:**
       - Use groupOrdersByPeriod() to group orders
       - Render section headers: "Oggi", "Questa settimana", etc.
       - Render OrderCard for each order in each group
       - Pass expanded={order.id === expandedOrderId}
       - Pass onToggle={() => handleToggle(order.id)}

    4. **Expand/collapse logic:**
       - handleToggle(orderId): if already expanded â†’ collapse, else fetch detail and expand
       - Fetch detail only once per order (cache in state)
       - Show loading spinner in card while fetching detail

    5. **Loading/error states:**
       - Loading: Show skeleton cards or spinner
       - Error: Show error message with retry button
       - Empty: Show "Nessun ordine trovato" message

    6. **Page layout:**
       - Header: "ðŸ“¦ Storico Ordini"
       - Filter controls (Task 2)
       - Timeline content
       - Scroll container (overflow-y: auto)

    Use fetch API with Authorization header.
    Follow existing page patterns from project (e.g., OrderForm).
  </action>
  <verify>
    TypeScript compiles without errors:
    cd archibald-web-app/frontend && npx tsc --noEmit
  </verify>
  <done>OrderHistory page created with timeline layout and API integration</done>
</task>

<task type="auto">
  <name>Task 2: Implement filters UI (customer search, date range, status)</name>
  <files>archibald-web-app/frontend/src/pages/OrderHistory.tsx</files>
  <action>
    Add filter controls to OrderHistory page:

    1. **Filter UI components:**
       - Customer search: Text input with placeholder "Cerca cliente..."
       - Date range: Two date inputs (Da: ..., A: ...)
       - Status filter: Dropdown or chips (Tutti, In lavorazione, Evaso, Spedito)

    2. **Filter layout:**
       - Horizontal layout on desktop
       - Stacked on mobile (responsive)
       - Clear filters button (X icon) when any filter active
       - Subtle styling (banking app aesthetic)

    3. **Filter logic:**
       - onChange handlers update filters state
       - useEffect refetches orders when filters change
       - Debounce customer search input (500ms) to avoid excessive API calls
       - Date inputs: use <input type="date" /> (native browser picker)

    4. **Status filter options:**
       - "Tutti" (default, clears status filter)
       - "In lavorazione"
       - "Evaso"
       - "Spedito"
       - Render as chip buttons (selected state = highlighted)

    5. **Clear filters:**
       - Button visible when any filter is active
       - Click resets all filters to defaults
       - Refetches unfiltered order list

    Use controlled components (value from state).
    Apply filters via API query params (backend filtering from Plan 10-05).
  </action>
  <verify>
    TypeScript compiles without errors:
    cd archibald-web-app/frontend && npx tsc --noEmit
  </verify>
  <done>Filter controls implemented with customer search, date range, and status chips</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation and connect to app routing</name>
  <files>archibald-web-app/frontend/src/App.tsx, archibald-web-app/frontend/src/components/Header.tsx</files>
  <action>
    Integrate OrderHistory page into app navigation:

    1. **Add route to App.tsx:**
       - Import OrderHistory component
       - Add route: <Route path="/orders" element={<OrderHistory />} />
       - Position after existing routes (/, /login, /orders/status, etc.)

    2. **Add navigation link to Header:**
       - Add "ðŸ“¦ Storico" button/link next to existing nav items
       - Use useNavigate() or <Link to="/orders" />
       - Highlight when active (check current path)

    3. **Auth protection:**
       - OrderHistory requires authentication (check localStorage JWT)
       - If not authenticated, redirect to login (like OrderForm)
       - Use same auth pattern as existing protected routes

    4. **Navigation flow:**
       - From OrderForm â†’ Header â†’ "Storico" â†’ OrderHistory page
       - From OrderHistory â†’ Header â†’ "Nuovo Ordine" â†’ back to OrderForm
       - Breadcrumb or back button optional (keep simple for MVP)

    Follow existing routing patterns (React Router).
    Maintain consistent navigation UX with rest of app.
  </action>
  <verify>
    TypeScript compiles without errors:
    cd archibald-web-app/frontend && npx tsc --noEmit
  </verify>
  <done>OrderHistory page integrated into app routing with navigation link in header</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete order history feature with banking app timeline, filters, and expandable cards</what-built>
  <how-to-verify>
    1. Start dev servers:
       ```bash
       # Terminal 1 - Backend
       cd archibald-web-app/backend && npm run dev

       # Terminal 2 - Frontend
       cd archibald-web-app/frontend && npm run dev
       ```

    2. Login to app (http://localhost:5173)

    3. Navigate to "ðŸ“¦ Storico" via header link

    4. Verify order list display:
       - Orders grouped by period (Oggi, Settimana, Mese, Vecchi)
       - Cards show: customer, date, total, status badge
       - "Tracking disponibile" badge for shipped orders
       - "Vedi documenti" button visible on all cards

    5. Test expand/collapse:
       - Click card â†’ expands to show detail
       - Detail shows: article list, status timeline, customer info, tracking, documents
       - Click again â†’ collapses back to summary

    6. Test filters:
       - Customer search: Type customer name â†’ list filters in real-time
       - Date range: Select date range â†’ only orders in range shown
       - Status filter: Click status chip â†’ only orders with that status shown
       - Clear filters: Click X â†’ all filters reset, full list shown

    7. Verify banking app UX:
       - Cards have subtle shadows and rounded corners
       - Status badges are colored (blue/green/purple)
       - Timeline shows vertical line with status dots
       - Smooth expand/collapse animation
       - Overall aesthetic matches Intesa/UniCredit reference

    8. Test edge cases:
       - No orders: Shows "Nessun ordine trovato"
       - Loading state: Shows spinner or skeleton
       - Network error: Shows error message with retry
       - Order without tracking: No tracking badge (graceful)
       - Order without documents: No documents shown (graceful)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] OrderHistory page created with timeline layout
- [ ] API integration fetches orders and detail on expand
- [ ] Filter controls implemented (customer, date, status)
- [ ] Navigation link added to app header
- [ ] Loading, error, and empty states handled
- [ ] Banking app UX achieved (cards, timeline, styling)
- [ ] TypeScript compilation passes without errors
- [ ] Manual verification checkpoint passed
</verification>

<success_criteria>
- OrderHistory page displays orders in banking app timeline style
- Temporal grouping shows Oggi/Settimana/Mese/Vecchi sections
- Cards expand inline to show complete order detail
- Filters work correctly (customer search, date range, status)
- All CONTEXT.md requirements implemented and verified
- Navigation integrated into app flow
- Phase 10 Order History feature complete and production-ready
</success_criteria>

<output>
After completion, create `.planning/phases/10-order-history/10-07-SUMMARY.md`:

# Phase 10 Plan 07: Order History Page & Integration Summary

**Created complete OrderHistory page with timeline layout, filters, and API integration - banking app style.**

## Accomplishments

- Created OrderHistory page with timeline layout
- Integrated OrderCard and OrderTimeline components
- Implemented API calls to fetch orders and details
- Added filter controls (customer search, date range, status chips)
- Integrated into app navigation with header link
- Verified complete feature with manual testing
- Banking app UX (Intesa/UniCredit aesthetic) achieved

## Files Created/Modified

- `archibald-web-app/frontend/src/pages/OrderHistory.tsx` - Main page
- `archibald-web-app/frontend/src/pages/OrderHistory.module.css` - Page styling
- `archibald-web-app/frontend/src/App.tsx` - Route added
- `archibald-web-app/frontend/src/components/Header.tsx` - Navigation link

## Decisions Made

[Filter UX approach, expand/collapse interaction, or API call optimization]

## Issues Encountered

[Any integration issues, performance concerns, or UX refinements needed]

## Next Phase Readiness

**Phase 10 Order History: COMPLETE âœ…**

All CONTEXT.md requirements implemented:
- âœ… Banking app timeline (Intesa/UniCredit style)
- âœ… Temporal grouping (Oggi, Settimana, Mese, Vecchi)
- âœ… Expandable cards inline (no page navigation)
- âœ… Complete order detail (articles, timeline, customer, tracking, documents)
- âœ… Filters: customer search, date range, status (all equally essential)
- âœ… Status badges and tracking badge
- âœ… "Vedi documenti" button

Ready for Phase 11 (Order Management) or next roadmap phase.
</output>
