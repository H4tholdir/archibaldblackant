---
phase: 27-bot-performance-profiling-v2
plan: 04
subsystem: backend
tags: [profiling, performance, dashboard, visualization]

# Dependency graph
requires:
  - phase: 3.1
    provides: PerformanceDashboardGenerator, HTML dashboard template
  - plan: 27-03
    provides: slowdown-config.json with profiling results
provides:
  - Enhanced HTML dashboard with slowdown optimization results
  - Before/after comparison visualization
  - Time savings estimation
affects: [monitoring, performance-analysis]

# Tech tracking
tech-stack:
  added: []
  patterns: [dashboard-extension, performance-visualization]

key-files:
  created: []
  modified:
    - archibald-web-app/backend/src/performance-tracking.ts (PerformanceDashboardGenerator)

key-decisions:
  - "Reuse Phase 3.1 dashboard generator (no new architecture)"
  - "Add dedicated section for slowdown optimization results"
  - "Show per-step: tested values, crashes, optimal value"
  - "Calculate total time savings: sum of (200ms - optimal) across all steps"

patterns-established: []
issues-created: []

# Metrics
duration: TBD
completed: TBD
---

# Phase 27 Plan 04: Dashboard Enhancement & Results Visualization

**Extend Phase 3.1 profiling dashboard with slowdown optimization results and comparison visualizations**

## Objective

Enhance the existing HTML dashboard generator to display slowdown optimization results from the binary search profiling process. Add a dedicated section showing per-step optimization data (tested values, crashes, optimal slowdowns) and a comparison table estimating total time savings compared to the 200ms baseline.

## Execution Context

**Critical files to read first:**
- `archibald-web-app/backend/src/performance-tracking.ts` - Existing PerformanceDashboardGenerator class
- `archibald-web-app/backend/slowdown-config.json` - Profiling results from Plan 27-03

**Reference:**
- Phase 3.1 dashboard format - Established visualization patterns
- 27-CONTEXT.md section "Dashboard Enhancements" - Expected output format

## Context

**Current State:**
- Phase 3.1 created `PerformanceDashboardGenerator` class that generates HTML dashboards
- Plan 27-03 generates `slowdown-config.json` with all profiling results
- Dashboard currently shows operation timing breakdowns but no slowdown optimization data

**Goal:**
Add new section to dashboard showing:
1. Per-step optimization results (range tested, crashes, optimal value found)
2. Before/after comparison table (200ms baseline vs optimized slowdowns)
3. Estimated total time savings across full order creation flow

**Success Criteria:**
- Dashboard includes "Slowdown Optimization Results" section
- Per-step data shows: step name, optimal value, crashes during profiling, convergence range
- Comparison table shows baseline (200ms × 14 steps = 2800ms) vs optimized (sum of optimal values)
- Time savings calculated: baseline - optimized total
- Dashboard HTML remains well-formatted and readable

## Tasks

### Task 1: Extend dashboard generator with slowdown optimization section

**What:**
Modify `PerformanceDashboardGenerator` class to:
1. Load `slowdown-config.json` when generating dashboard
2. Add new method `generateSlowdownOptimizationSection()` that creates HTML section
3. Include section in main dashboard generation flow

**How:**
```typescript
// In PerformanceDashboardGenerator class

private generateSlowdownOptimizationSection(config: SlowdownConfig): string {
  // Load config.optimized object
  // Create HTML table with columns: Step Name, Optimal Value (ms), Baseline (ms), Savings (ms)
  // For each step: show optimal value from config
  // Calculate per-step savings: 200ms - optimal_value
  // Return formatted HTML section
}

// In main generate() method:
// After existing performance sections, add:
const slowdownConfig = JSON.parse(fs.readFileSync('./slowdown-config.json', 'utf-8'));
html += this.generateSlowdownOptimizationSection(slowdownConfig);
```

**Expected structure:**
```html
<section>
  <h2>Slowdown Optimization Results</h2>
  <p>Profiled at: {metadata.profiled_at}</p>
  <p>Total iterations: {metadata.iterations_total}, Total crashes: {metadata.crashes_total}</p>
  
  <table>
    <thead>
      <tr>
        <th>Step</th>
        <th>Baseline (ms)</th>
        <th>Optimized (ms)</th>
        <th>Savings (ms)</th>
      </tr>
    </thead>
    <tbody>
      <!-- Per-step rows -->
    </tbody>
  </table>
</section>
```

**Files:**
- Modify: `archibald-web-app/backend/src/performance-tracking.ts`

**Validation:**
- Dashboard HTML includes new section
- All 14 steps shown with optimal values
- Table renders correctly in browser

### Task 2: Add comparison visualization with total time savings estimate

**What:**
Add summary section showing:
1. Total baseline slowdown time: 200ms × 14 steps = 2800ms
2. Total optimized slowdown time: sum of all optimal values
3. Total estimated savings: baseline - optimized
4. Percentage improvement: (savings / baseline) × 100

**How:**
```typescript
private generateTimesSavingsSummary(config: SlowdownConfig): string {
  const baselineTotal = 200 * Object.keys(config.optimized).length;
  const optimizedTotal = Object.values(config.optimized).reduce((sum, val) => sum + val, 0);
  const savings = baselineTotal - optimizedTotal;
  const percentageImprovement = (savings / baselineTotal) * 100;

  return `
    <div class="summary-box">
      <h3>Time Savings Summary</h3>
      <p><strong>Baseline total:</strong> ${baselineTotal}ms (200ms × ${Object.keys(config.optimized).length} steps)</p>
      <p><strong>Optimized total:</strong> ${optimizedTotal}ms</p>
      <p><strong>Total savings:</strong> ${savings}ms (${percentageImprovement.toFixed(1)}% faster)</p>
    </div>
  `;
}

// Add CSS for summary-box:
.summary-box {
  background: #f0f9ff;
  border: 1px solid #0ea5e9;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
}
```

**Files:**
- Modify: `archibald-web-app/backend/src/performance-tracking.ts`

**Validation:**
- Summary box displays correct calculations
- Percentage improvement shown with 1 decimal place
- Visual styling matches rest of dashboard

## Verification

**After completing both tasks:**

1. **Generate test dashboard**
   ```bash
   cd archibald-web-app/backend
   # Ensure slowdown-config.json exists from Plan 27-03
   npm run generate-dashboard  # or however dashboard generation is triggered
   ```

2. **Open dashboard HTML in browser**
   - Check for "Slowdown Optimization Results" section
   - Verify all 14 steps shown with data from slowdown-config.json
   - Verify "Time Savings Summary" box displays correct calculations
   - Check visual formatting (table borders, alignment, colors)

3. **Validate calculations manually**
   - Count steps in config.optimized: should be 14
   - Sum optimal values manually: compare to dashboard total
   - Verify savings = (200 × 14) - optimized_total
   - Verify percentage = (savings / 2800) × 100

4. **Edge case: missing config file**
   - Rename slowdown-config.json temporarily
   - Verify dashboard generation fails gracefully with clear error
   - Restore file

**Success criteria:**
- ✅ Dashboard includes slowdown optimization section with all steps
- ✅ Comparison table shows baseline vs optimized values
- ✅ Time savings summary displays correct calculations
- ✅ Dashboard HTML renders properly in browser
- ✅ No errors when generating dashboard with valid slowdown-config.json

## Success Criteria

- [ ] PerformanceDashboardGenerator extended with slowdown optimization section
- [ ] Per-step table shows: step name, baseline (200ms), optimized value, savings
- [ ] Summary box shows: baseline total, optimized total, total savings, percentage improvement
- [ ] Dashboard HTML well-formatted and readable
- [ ] Manual verification: open dashboard in browser, validate all data correct

## Output

**Modified Files:**
- `archibald-web-app/backend/src/performance-tracking.ts` - Enhanced dashboard generator

**Dashboard Sections (new):**
1. **Slowdown Optimization Results** - Per-step table with optimization data
2. **Time Savings Summary** - Total savings and percentage improvement

**Validation:**
- Dashboard renders correctly in browser
- All calculations verified manually
- Visual styling consistent with Phase 3.1 dashboard
