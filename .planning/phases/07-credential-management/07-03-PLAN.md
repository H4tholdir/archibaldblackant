# Phase 7 Plan 3: Checkbox "Ricorda Credenziali" & PIN Setup Flow

<objective>
Add "Ricorda credenziali" checkbox to login form and implement PIN setup wizard after successful login.

**Purpose:** Create the UX entry point for credential saving. User opts in via checkbox, then configures PIN for future unlocking. Banking app style (Intesa, UniCredit reference).

**Output:** Complete "remember credentials" flow operational - from checkbox selection through PIN setup to encrypted storage.
</objective>

<execution_context>
@.planning/phases/07-credential-management/07-CONTEXT.md (user vision: checkbox + PIN setup)
@.planning/phases/07-credential-management/07-RESEARCH.md (security patterns)
@archibald-web-app/frontend/src/components/LoginModal.tsx (existing login UI)
@archibald-web-app/frontend/src/hooks/useAuth.ts (auth state management)
@archibald-web-app/frontend/src/services/credential-store.ts (from Plan 07-02)
</execution_context>

<context>
**Current State (Phase 6):**
- LoginModal component with username/password fields
- Login button triggers useAuth.login()
- Successful login → JWT stored in localStorage → modal closes
- No credential persistence

**Plan 07-02 Output:**
- CredentialStore service with encryption/decryption
- Methods: storeCredentials(userId, username, password, pin)
- IndexedDB encrypted storage operational

**User Vision from 07-CONTEXT.md:**
> Quando l'agente fa login per la prima volta, trova un checkbox "Ricorda credenziali su questo device" sotto i campi username/password. Se lo seleziona, dopo un login riuscito l'app gli chiede di configurare un sistema di sblocco sicuro.

> L'esperienza è simile a una banking app (Intesa, UniCredit): su mobile usa Face ID/Touch ID se disponibile, altrimenti PIN a 6 cifre. Su desktop usa sempre PIN a 6 cifre.

**Implementation Goals:**
1. Add checkbox "Ricorda credenziali su questo device" below login fields
2. After successful login + checkbox checked → show PIN setup wizard
3. PIN setup wizard:
   - Step 1: Enter 6-digit PIN
   - Step 2: Confirm 6-digit PIN (must match)
   - Validate: PIN must be 6 digits, no weak patterns (000000, 123456, etc.)
4. After PIN setup → store encrypted credentials using CredentialStore
5. Banking app UX: clean modal, clear instructions, 6-digit keypad

**UI Flow:**
```
LoginModal (existing)
  ├─ Username field
  ├─ Password field
  ├─ [NEW] Checkbox: "Ricorda credenziali su questo device"
  └─ Login button
     ↓ (successful login + checkbox checked)
PinSetupWizard (NEW component)
  ├─ Step 1: "Crea un PIN di 6 cifre"
  │    └─ 6-digit input (numeric keypad)
  ├─ Step 2: "Conferma il PIN"
  │    └─ 6-digit input (must match Step 1)
  ├─ Validation: reject weak PINs (000000, 123456, 111111, etc.)
  └─ Success → store credentials → close wizard
```

**PIN Validation Rules:**
- Must be exactly 6 digits
- Cannot be all same digit (000000, 111111, etc.)
- Cannot be sequential (123456, 654321)
- Cannot be common patterns (121212, 010101, etc.)

**Biometric Support:**
- Phase 7 Plan 3: PIN only (desktop and mobile)
- Phase 7 Plan 4: Add biometric option for mobile (WebAuthn)
- This plan focuses on PIN foundation
</context>

<tasks>

<task id="1" type="auto">
<files>
- archibald-web-app/frontend/src/components/LoginModal.tsx
</files>

<action>
Add checkbox "Ricorda credenziali su questo device" to LoginModal.

Changes to LoginModal.tsx:

1. **Add state for checkbox:**
```typescript
const [rememberCredentials, setRememberCredentials] = useState(false);
```

2. **Add checkbox to form (below password field, above login button):**
```tsx
<div className="remember-credentials">
  <label>
    <input
      type="checkbox"
      checked={rememberCredentials}
      onChange={(e) => setRememberCredentials(e.target.checked)}
    />
    <span>Ricorda credenziali su questo device</span>
  </label>
</div>
```

3. **Update login handler to pass checkbox state to parent:**

Current: `const success = await login(username, password);`

New:
```typescript
const success = await login(username, password, rememberCredentials);
```

4. **Update useAuth.login() signature:**

In `archibald-web-app/frontend/src/hooks/useAuth.ts`:

```typescript
// OLD signature
const login = async (username: string, password: string): Promise<boolean>

// NEW signature
const login = async (
  username: string,
  password: string,
  rememberCredentials: boolean = false
): Promise<boolean>
```

5. **Store rememberCredentials flag in auth state:**

When login succeeds and rememberCredentials is true, set a flag that triggers PIN setup:

```typescript
if (response.success && response.token && response.user) {
  localStorage.setItem(TOKEN_KEY, response.token);
  setState({
    isAuthenticated: true,
    user: response.user,
    token: response.token,
    isLoading: false,
    error: null,
    needsPinSetup: rememberCredentials, // NEW flag
  });
  return true;
}
```

6. **Add CSS for checkbox:**

In `archibald-web-app/frontend/src/App.css` (or LoginModal styles):

```css
.remember-credentials {
  margin: 1rem 0;
  text-align: left;
}

.remember-credentials label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-size: 0.9rem;
}

.remember-credentials input[type="checkbox"] {
  width: 1.2rem;
  height: 1.2rem;
  cursor: pointer;
}
```

Run: `npm run build` to verify TypeScript compiles
</action>

<verify>
- [ ] Checkbox added to LoginModal below password field
- [ ] LoginModal passes rememberCredentials to useAuth.login()
- [ ] useAuth.login() accepts rememberCredentials parameter
- [ ] AuthState includes needsPinSetup flag
- [ ] CSS added for checkbox styling
- [ ] npm run build succeeds (no TypeScript errors)
</verify>

<done>
Checkbox "Ricorda credenziali" added to login form. Ready to implement PIN setup wizard.
</done>
</task>

<task id="2" type="auto">
<files>
- archibald-web-app/frontend/src/components/PinSetupWizard.tsx (NEW)
- archibald-web-app/frontend/src/components/PinInput.tsx (NEW - reusable 6-digit input)
</files>

<action>
Create PIN setup wizard component with 2-step flow (create PIN → confirm PIN).

**Step 1: Create PinInput reusable component**

File: `archibald-web-app/frontend/src/components/PinInput.tsx`

```typescript
import { useState, useRef, KeyboardEvent } from 'react';

interface PinInputProps {
  length?: number;
  value: string;
  onChange: (pin: string) => void;
  autoFocus?: boolean;
}

export function PinInput({ length = 6, value, onChange, autoFocus = false }: PinInputProps) {
  const inputRefs = useRef<(HTMLInputElement | null)[]>([]);

  const handleChange = (index: number, digit: string) => {
    // Only allow digits
    if (!/^\d*$/.test(digit)) return;

    // Update value at index
    const newValue = value.split('');
    newValue[index] = digit;
    const newPin = newValue.join('');

    onChange(newPin.slice(0, length));

    // Auto-focus next input
    if (digit && index < length - 1) {
      inputRefs.current[index + 1]?.focus();
    }
  };

  const handleKeyDown = (index: number, e: KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Backspace' && !value[index] && index > 0) {
      // Focus previous input on backspace if current is empty
      inputRefs.current[index - 1]?.focus();
    }
  };

  const handlePaste = (e: React.ClipboardEvent) => {
    e.preventDefault();
    const pastedText = e.clipboardData.getData('text').replace(/\D/g, '');
    onChange(pastedText.slice(0, length));
  };

  return (
    <div className="pin-input" onPaste={handlePaste}>
      {Array.from({ length }).map((_, index) => (
        <input
          key={index}
          ref={(el) => (inputRefs.current[index] = el)}
          type="tel"
          inputMode="numeric"
          pattern="\d"
          maxLength={1}
          value={value[index] || ''}
          onChange={(e) => handleChange(index, e.target.value)}
          onKeyDown={(e) => handleKeyDown(index, e)}
          autoFocus={autoFocus && index === 0}
          className="pin-digit"
        />
      ))}
    </div>
  );
}
```

**Step 2: Create PinSetupWizard component**

File: `archibald-web-app/frontend/src/components/PinSetupWizard.tsx`

```typescript
import { useState } from 'react';
import { PinInput } from './PinInput';

interface PinSetupWizardProps {
  onComplete: (pin: string) => Promise<void>;
  onCancel: () => void;
}

export function PinSetupWizard({ onComplete, onCancel }: PinSetupWizardProps) {
  const [step, setStep] = useState<'create' | 'confirm'>('create');
  const [pin, setPin] = useState('');
  const [confirmPin, setConfirmPin] = useState('');
  const [error, setError] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  const validatePin = (pinValue: string): string | null => {
    if (pinValue.length !== 6) {
      return 'Il PIN deve essere di 6 cifre';
    }

    // Check for all same digit
    if (/^(\d)\1{5}$/.test(pinValue)) {
      return 'PIN troppo semplice. Scegli un PIN più sicuro.';
    }

    // Check for sequential patterns
    const sequences = ['012345', '123456', '234567', '345678', '456789', '543210', '654321'];
    if (sequences.includes(pinValue)) {
      return 'PIN sequenziale non permesso. Scegli un PIN più sicuro.';
    }

    // Check for common patterns
    const commonPatterns = ['121212', '010101', '101010', '000000', '111111', '222222'];
    if (commonPatterns.includes(pinValue)) {
      return 'PIN troppo comune. Scegli un PIN più sicuro.';
    }

    return null;
  };

  const handleCreateComplete = () => {
    setError('');
    const validationError = validatePin(pin);
    if (validationError) {
      setError(validationError);
      return;
    }
    setStep('confirm');
  };

  const handleConfirmComplete = async () => {
    setError('');

    if (confirmPin !== pin) {
      setError('I PIN non coincidono. Riprova.');
      setConfirmPin('');
      return;
    }

    setIsSubmitting(true);
    try {
      await onComplete(pin);
    } catch (err) {
      setError('Errore durante il salvataggio del PIN. Riprova.');
      setIsSubmitting(false);
    }
  };

  const handleBack = () => {
    setStep('create');
    setPin('');
    setConfirmPin('');
    setError('');
  };

  return (
    <div className="pin-setup-wizard-overlay">
      <div className="pin-setup-wizard">
        <div className="wizard-header">
          <h2>Configura PIN di sicurezza</h2>
          <p className="wizard-subtitle">
            {step === 'create'
              ? 'Crea un PIN di 6 cifre per proteggere le tue credenziali'
              : 'Conferma il PIN inserito'}
          </p>
        </div>

        <div className="wizard-body">
          {step === 'create' ? (
            <>
              <PinInput
                value={pin}
                onChange={setPin}
                autoFocus
              />
              <button
                onClick={handleCreateComplete}
                disabled={pin.length !== 6}
                className="wizard-button-primary"
              >
                Continua
              </button>
            </>
          ) : (
            <>
              <PinInput
                value={confirmPin}
                onChange={setConfirmPin}
                autoFocus
              />
              <div className="wizard-actions">
                <button onClick={handleBack} className="wizard-button-secondary">
                  Indietro
                </button>
                <button
                  onClick={handleConfirmComplete}
                  disabled={confirmPin.length !== 6 || isSubmitting}
                  className="wizard-button-primary"
                >
                  {isSubmitting ? 'Salvataggio...' : 'Conferma'}
                </button>
              </div>
            </>
          )}

          {error && <div className="wizard-error">{error}</div>}
        </div>

        <button onClick={onCancel} className="wizard-close" aria-label="Chiudi">
          ✕
        </button>
      </div>
    </div>
  );
}
```

**Step 3: Add CSS styles**

In `archibald-web-app/frontend/src/App.css`:

```css
/* PIN Input */
.pin-input {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin: 2rem 0;
}

.pin-digit {
  width: 3rem;
  height: 3.5rem;
  font-size: 1.5rem;
  text-align: center;
  border: 2px solid #ddd;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.2s;
}

.pin-digit:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

/* PIN Setup Wizard */
.pin-setup-wizard-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.pin-setup-wizard {
  background: white;
  border-radius: 12px;
  padding: 2rem;
  max-width: 500px;
  width: 90%;
  position: relative;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.wizard-header {
  text-align: center;
  margin-bottom: 2rem;
}

.wizard-header h2 {
  margin: 0 0 0.5rem 0;
  font-size: 1.5rem;
  color: #333;
}

.wizard-subtitle {
  color: #666;
  font-size: 0.95rem;
  margin: 0;
}

.wizard-body {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.wizard-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.wizard-button-primary,
.wizard-button-secondary {
  padding: 0.75rem 2rem;
  font-size: 1rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.wizard-button-primary {
  background-color: #007bff;
  color: white;
  min-width: 120px;
}

.wizard-button-primary:hover:not(:disabled) {
  background-color: #0056b3;
}

.wizard-button-primary:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.wizard-button-secondary {
  background-color: #f0f0f0;
  color: #333;
}

.wizard-button-secondary:hover {
  background-color: #e0e0e0;
}

.wizard-error {
  color: #dc3545;
  font-size: 0.9rem;
  margin-top: 1rem;
  text-align: center;
}

.wizard-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: transparent;
  border: none;
  font-size: 1.5rem;
  color: #999;
  cursor: pointer;
  width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.2s;
}

.wizard-close:hover {
  background-color: #f0f0f0;
  color: #333;
}
```

Run: `npm run build` to verify compilation
</action>

<verify>
- [ ] PinInput.tsx created with 6-digit input component
- [ ] PinSetupWizard.tsx created with 2-step flow
- [ ] PIN validation rules implemented (no weak patterns)
- [ ] CSS styles added for wizard and PIN input
- [ ] npm run build succeeds
</verify>

<done>
PIN setup wizard components created. Ready to integrate with App.tsx and useAuth.
</done>
</task>

<task id="3" type="auto">
<files>
- archibald-web-app/frontend/src/App.tsx
- archibald-web-app/frontend/src/hooks/useAuth.ts
</files>

<action>
Integrate PinSetupWizard into App.tsx and connect to CredentialStore.

**Step 1: Update useAuth hook to handle PIN setup**

In `archibald-web-app/frontend/src/hooks/useAuth.ts`:

1. Add needsPinSetup to AuthState:
```typescript
export interface AuthState {
  isAuthenticated: boolean;
  user: authApi.User | null;
  token: string | null;
  isLoading: boolean;
  error: string | null;
  needsPinSetup: boolean; // NEW
}
```

2. Initialize with needsPinSetup: false

3. Set needsPinSetup: true when login succeeds with rememberCredentials

4. Add completePinSetup method:
```typescript
const completePinSetup = async (pin: string, username: string, password: string): Promise<void> => {
  if (!state.user) return;

  const credentialStore = getCredentialStore();
  await credentialStore.initialize();
  await credentialStore.storeCredentials(state.user.id, username, password, pin);

  setState(prev => ({ ...prev, needsPinSetup: false }));
};
```

5. Add skipPinSetup method (for cancel):
```typescript
const skipPinSetup = () => {
  setState(prev => ({ ...prev, needsPinSetup: false }));
};
```

6. Return new methods from hook:
```typescript
return {
  ...state,
  login,
  logout,
  completePinSetup, // NEW
  skipPinSetup,      // NEW
};
```

**Step 2: Integrate PinSetupWizard in App.tsx**

In `archibald-web-app/frontend/src/App.tsx`:

1. Import PinSetupWizard:
```typescript
import { PinSetupWizard } from './components/PinSetupWizard';
```

2. Store username/password temporarily for PIN setup:
```typescript
const [tempCredentials, setTempCredentials] = useState<{username: string; password: string} | null>(null);
```

3. Modify login handler in LoginModal to store credentials:
```typescript
// In LoginModal, after successful login:
if (rememberCredentials) {
  setTempCredentials({ username, password });
}
```

4. Show PinSetupWizard when needsPinSetup is true:
```typescript
{needsPinSetup && tempCredentials && (
  <PinSetupWizard
    onComplete={async (pin) => {
      await completePinSetup(pin, tempCredentials.username, tempCredentials.password);
      setTempCredentials(null); // Clear from memory
    }}
    onCancel={() => {
      skipPinSetup();
      setTempCredentials(null); // Clear from memory
    }}
  />
)}
```

**Step 3: Update LoginModal to pass credentials back**

This is tricky - we need username/password after successful login for PIN setup.

Options:
A. Pass credentials back via callback
B. Store in App.tsx state temporarily
C. Pass to useAuth.login and return them

Choose **Option B** (cleanest separation):

In App.tsx:
```typescript
const handleLoginSuccess = (username: string, password: string, remember: boolean) => {
  if (remember) {
    setTempCredentials({ username, password });
  }
};
```

Pass to LoginModal:
```typescript
<LoginModal
  onLoginSuccess={handleLoginSuccess}
  // ... other props
/>
```

Update LoginModal to call onLoginSuccess after successful login:
```typescript
const success = await login(username, password, rememberCredentials);
if (success && rememberCredentials) {
  onLoginSuccess?.(username, password, rememberCredentials);
}
```

Run: `npm run build` to verify integration
</action>

<verify>
- [ ] useAuth hook includes needsPinSetup flag
- [ ] useAuth exports completePinSetup and skipPinSetup methods
- [ ] completePinSetup calls CredentialStore.storeCredentials
- [ ] App.tsx shows PinSetupWizard when needsPinSetup is true
- [ ] Temporary credentials stored for PIN setup (cleared after)
- [ ] LoginModal passes credentials to App for PIN setup
- [ ] npm run build succeeds
</verify>

<done>
PIN setup wizard integrated. Complete flow: checkbox → login → PIN wizard → encrypted storage.
</done>
</task>

<task id="4" type="checkpoint:human-verify">
<files>
- Browser: http://localhost:5173 (frontend)
- Browser DevTools → Application → IndexedDB
</files>

<action>
**Manual UAT Checkpoint**

User should verify complete "Ricorda credenziali" flow:

1. **Start Backend & Frontend:**
   ```bash
   # Terminal 1: Backend
   cd archibald-web-app/backend
   npm run dev

   # Terminal 2: Frontend
   cd archibald-web-app/frontend
   npm run dev
   ```

2. **Test Flow:**
   - Open http://localhost:5173
   - Login modal appears
   - ✅ Verify checkbox "Ricorda credenziali su questo device" visible below password field
   - Enter username: `ikiA0930`, password: `Fresis26@`
   - ✅ Check the "Ricorda credenziali" checkbox
   - Click "Accedi" button
   - ✅ Puppeteer login succeeds (see logs)
   - ✅ PIN setup wizard appears with title "Configura PIN di sicurezza"

3. **Test PIN Creation:**
   - ✅ Enter 6-digit PIN (e.g., `456789`)
   - ✅ Click "Continua" button
   - ✅ Wizard moves to confirmation step ("Conferma il PIN")
   - ✅ Re-enter same PIN: `456789`
   - ✅ Click "Conferma" button
   - ✅ Wizard closes, app shows main interface

4. **Verify Encrypted Storage:**
   - Open DevTools → Application → IndexedDB → ArchibaldCredentials → credentials
   - ✅ Find entry with userId (from JWT user.id)
   - ✅ Verify encryptedData is ArrayBuffer (not readable)
   - ✅ Verify iv and salt are Uint8Array
   - ✅ Cannot see plaintext username or password

5. **Test PIN Validation:**
   - Logout and login again with checkbox checked
   - Try weak PIN: `000000` → ✅ Should show error "PIN troppo semplice"
   - Try sequential PIN: `123456` → ✅ Should show error "PIN sequenziale non permesso"
   - Try valid PIN: `987654` → ✅ Should accept

6. **Test PIN Confirmation Mismatch:**
   - Enter PIN: `111222`
   - Confirm with different PIN: `222333`
   - ✅ Should show error "I PIN non coincidono. Riprova."
   - ✅ Confirmation input clears for retry

7. **Test Cancel Flow:**
   - Login with checkbox checked
   - PIN wizard appears
   - ✅ Click X (close button)
   - ✅ Wizard closes, no credentials stored (verify IndexedDB)
   - ✅ App works normally (just no credential saving)

**Expected Outcome:**
✅ Checkbox visible and functional
✅ PIN wizard appears after login with checkbox
✅ PIN validation rejects weak patterns
✅ Credentials stored encrypted in IndexedDB
✅ Cancel flow works (no storage)

User confirms: "verified" or reports issues
</action>

<verify>
User confirms:
- [ ] Checkbox "Ricorda credenziali" visible in login form
- [ ] PIN wizard appears after login with checkbox checked
- [ ] 6-digit PIN input works (numeric keypad on mobile)
- [ ] PIN validation rejects weak patterns (000000, 123456, etc.)
- [ ] PIN confirmation validates match
- [ ] Encrypted credentials stored in IndexedDB
- [ ] Cancel flow works (X button closes wizard)
- [ ] No plaintext credentials visible in storage
</verify>

<done>
Manual verification complete. "Ricorda credenziali" flow operational with PIN setup and encrypted storage.
</done>
</task>

</tasks>

<verification>
**Success Criteria:**
- [x] Checkbox "Ricorda credenziali" added to LoginModal
- [x] PinSetupWizard component created (2-step flow)
- [x] PinInput component created (6-digit input)
- [x] PIN validation rules implemented (no weak patterns)
- [x] Integration with useAuth hook complete
- [x] Integration with CredentialStore complete
- [x] Manual UAT passes all checkpoints
- [x] Banking app UX style (clean, clear, 6-digit keypad)

**Quality Gates:**
- npm run build succeeds (TypeScript compiles)
- Login flow with checkbox works end-to-end
- PIN wizard appears after login with checkbox
- Encrypted credentials stored in IndexedDB
- No plaintext credentials anywhere in storage/memory
</verification>

<success_criteria>
Phase 7 Plan 3 succeeds when:

1. **UI Components Complete:**
   - Checkbox visible below password field in LoginModal
   - PinSetupWizard modal with 2-step flow operational
   - PinInput component with 6-digit numeric input
   - Banking app styling (clean, clear, professional)

2. **Flow Works End-to-End:**
   - User checks "Ricorda credenziali" → login → PIN wizard appears
   - PIN creation step → validation → confirmation step
   - Confirmation matches → credentials encrypted and stored
   - Cancel (X button) → wizard closes, no storage

3. **PIN Validation Effective:**
   - Rejects weak patterns: 000000, 111111, 123456, etc.
   - Rejects sequential patterns: 012345, 654321
   - Rejects common patterns: 121212, 010101
   - Confirmation mismatch → error + retry

4. **Security Maintained:**
   - Credentials encrypted in IndexedDB (via CredentialStore)
   - Temporary credentials cleared from memory after PIN setup
   - No plaintext passwords anywhere

5. **Ready for Next Plan:**
   - Plan 07-04 can build unlock flow (use stored credentials)
   - Plan 07-05 can add biometric support on top of PIN foundation

</success_criteria>

<output>
**Deliverables:**
1. `archibald-web-app/frontend/src/components/PinInput.tsx` - 6-digit PIN input
2. `archibald-web-app/frontend/src/components/PinSetupWizard.tsx` - PIN setup wizard
3. Updated `archibald-web-app/frontend/src/components/LoginModal.tsx` - checkbox added
4. Updated `archibald-web-app/frontend/src/hooks/useAuth.ts` - PIN setup methods
5. Updated `archibald-web-app/frontend/src/App.tsx` - wizard integration
6. CSS styles for PIN input and wizard (banking app style)

**Key Decisions:**
- PIN length: 6 digits (industry standard for banking apps)
- Validation: Reject weak patterns (security requirement)
- UX: 2-step wizard (create → confirm) for error prevention
- Styling: Banking app reference (Intesa, UniCredit) - clean, professional
- Temporary credentials: Stored in App.tsx state, cleared after PIN setup

**User Journey:**
1. User sees checkbox "Ricorda credenziali su questo device"
2. User checks box and logs in successfully
3. PIN wizard appears: "Crea un PIN di 6 cifre"
4. User enters PIN (validated for strength)
5. Wizard asks: "Conferma il PIN"
6. User confirms (must match)
7. Credentials encrypted and stored
8. Next login: Unlock flow (Plan 07-04)

**Ready for:** Plan 07-04 (Unlock flow with stored credentials)
</output>

---

**Phase:** 07-credential-management
**Plan:** 03 of 06
**Type:** Implementation (UI + Integration)
**Estimated Duration:** 90-120 min
