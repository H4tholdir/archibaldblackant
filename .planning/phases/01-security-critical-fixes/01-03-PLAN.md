# Plan 01-03: Secure .gitignore and .env.example

**Phase:** 1 - Security Critical Fixes
**Created:** 2026-01-11
**Status:** Ready to execute

## Goal

Ensure `.env` is properly ignored by git and create a safe `.env.example` template with placeholder values (no real credentials) to document required environment variables for future developers.

## Context

Current state (discovered during planning):

1. `.gitignore` already contains `.env` (line 8 of `archibald-web-app/backend/.gitignore`) ✅
2. `.env.example` EXISTS but contains REAL CREDENTIALS ❌:
   ```
   ARCHIBALD_USERNAME=[REDACTED-USERNAME]
   ARCHIBALD_PASSWORD=[REDACTED-PASSWORD]
   ```

**CRITICAL**: The `.env.example` file defeats the purpose of the security cleanup because it documents the real credentials. This file is meant to be committed to show developers what variables are needed, but with PLACEHOLDER values only.

After plan 01-02 cleans git history, this plan ensures:
- `.env` stays ignored (already correct)
- `.env.example` is safe to commit (currently unsafe)
- Root `.gitignore` also protects `.env` (defensive depth)

## Approach

1. Sanitize `.env.example` by replacing real credentials with descriptive placeholders
2. Add comprehensive security comments to `.env.example`
3. Verify root `.gitignore` also contains `.env` pattern
4. Document all required environment variables

## Tasks

<task id="1">
<description>Sanitize .env.example with placeholder values</description>
<details>
Replace the real credentials in `archibald-web-app/backend/.env.example` with safe placeholder values:

**Current (UNSAFE)**:
```
ARCHIBALD_URL=https://4.231.124.90/Archibald
ARCHIBALD_USERNAME=[REDACTED-USERNAME]
ARCHIBALD_PASSWORD=[REDACTED-PASSWORD]
```

**Target (SAFE)**:
```
# Archibald ERP Credentials
# SECURITY: Never commit real credentials to this file!
# SECURITY: Real credentials go in .env (which is gitignored)
ARCHIBALD_URL=https://your-archibald-server/Archibald
ARCHIBALD_USERNAME=your_username_here
ARCHIBALD_PASSWORD=your_secure_password_here
```

Add placeholders for Redis configuration that might be missing:
```
# Redis Configuration (for BullMQ job queue)
REDIS_HOST=localhost
REDIS_PORT=6379
```

Update the entire file with:
1. Clear security warnings at the top
2. Grouped sections (Archibald, Server, Logging, Redis)
3. Descriptive placeholders (not real values)
4. Comments explaining each variable's purpose

Commit this change with message: "security: sanitize .env.example (remove real credentials)"
</details>
<files>
- archibald-web-app/backend/.env.example (read/write)
</files>
</task>

<task id="2">
<description>Verify .gitignore coverage and add root-level protection</description>
<details>
Ensure `.env` files cannot be accidentally committed at ANY level:

1. **Verify backend .gitignore** (already correct):
   - Confirm `archibald-web-app/backend/.gitignore` contains `.env` on line 8
   - No changes needed (already correct)

2. **Check root .gitignore**:
   - Read `/Users/hatholdir/Downloads/Archibald/.gitignore`
   - If file doesn't exist OR doesn't contain `.env` pattern:
     - Create or update root `.gitignore` with:
       ```
       # Environment files (never commit!)
       .env
       .env.local
       .env.*.local
       **/.env

       # OS files
       .DS_Store
       **/.DS_Store

       # IDE
       .vscode/
       .idea/
       ```

3. **Defensive check - verify .env is ignored**:
   ```bash
   cd /Users/hatholdir/Downloads/Archibald
   git check-ignore archibald-web-app/backend/.env
   # Should output: archibald-web-app/backend/.env (confirming it's ignored)
   ```

If root `.gitignore` was created or updated, commit with message: "chore: strengthen .env protection in root .gitignore"
</details>
<files>
- .gitignore (read, potentially create/write)
- archibald-web-app/backend/.gitignore (read-only verification)
</files>
</task>

<task id="3">
<description>Document environment variable setup in README</description>
<details>
Create or update documentation to help future developers set up `.env` correctly:

1. **Check for backend README**:
   - Look for `archibald-web-app/backend/README.md`

2. **If README doesn't exist OR doesn't document .env setup**:
   - Add a "Configuration" section to backend README (or create the file):
   ```markdown
   ## Configuration

   ### Environment Variables

   The backend requires environment variables configured in a `.env` file.

   **Setup:**
   1. Copy the example file: `cp .env.example .env`
   2. Edit `.env` with your real credentials (never commit this file!)
   3. Required variables:
      - `ARCHIBALD_URL` - Your Archibald ERP server URL
      - `ARCHIBALD_USERNAME` - Your Archibald ERP username
      - `ARCHIBALD_PASSWORD` - Your Archibald ERP password
      - `REDIS_HOST` / `REDIS_PORT` - Redis server for job queue

   **Security:**
   - `.env` is gitignored and should NEVER be committed
   - Use strong passwords (12+ characters, mixed case, numbers, symbols)
   - Rotate credentials if accidentally exposed
   ```

3. **If README exists and documents .env**:
   - Review and update security warnings if needed
   - Ensure it references `.env.example` as the template

Commit if changes made: "docs: document .env setup and security practices"
</details>
<files>
- archibald-web-app/backend/README.md (read, potentially create/write)
</files>
</task>

## Success Criteria

- [ ] `.env.example` contains ONLY placeholder values (no real credentials)
- [ ] `.env.example` has clear security warnings
- [ ] `.env.example` documents all required environment variables
- [ ] Backend `.gitignore` contains `.env` (already true, verified)
- [ ] Root `.gitignore` contains `.env` patterns (created or verified)
- [ ] `git check-ignore` confirms `.env` is ignored
- [ ] Backend README documents `.env` setup process
- [ ] All changes committed with appropriate messages
- [ ] Running `git log -p -- .env.example` shows sanitized version only

## Dependencies

- **Plan 01-02 SHOULD complete first** - git history cleaned before committing new .env.example
- If plan 01-02 not done yet: Can still execute this plan, but .env.example changes should NOT be committed until AFTER 01-02

## Risks

- **Accidental commit of real .env**:
  - Mitigation: Verify `git check-ignore` confirms .env is ignored before continuing

- **.env.example still has old credentials in git history**:
  - Mitigation: Plan 01-02 cleans entire history including .env.example if it was committed with real values

- **Missing environment variables in documentation**:
  - Mitigation: Cross-reference config.ts and actual .env to ensure all variables are documented

## Notes

- This plan can be executed independently, but COMMITS should wait until after plan 01-02 (git history cleanup)
- `.gitignore` already correct in backend directory - main work is sanitizing .env.example
- The discovery that .env.example contains real credentials increases the importance of this plan
- Redis configuration (REDIS_HOST/REDIS_PORT) should be added to .env.example even if not currently in .env
- After this plan, `.env.example` is safe to commit and push to remote repositories

---

*Plan: 01-03 | Phase: 01-security-critical-fixes*
