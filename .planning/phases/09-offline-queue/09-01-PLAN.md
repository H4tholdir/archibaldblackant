---
phase: 09-offline-queue
plan: 01
type: execute
---

<objective>
Create Pending Orders UI to display offline queue with manual sync capability.

Purpose: Users need visibility into queued orders and ability to manually trigger sync (Phase 8 implemented automatic sync only).
Output: PendingOrdersView component showing queue status, order list, and manual sync button.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 8 Implementation (Already Complete):
@.planning/phases/08-offline-capability/08-07-SUMMARY.md

# Existing Infrastructure:
@archibald-web-app/frontend/src/services/pending-orders-service.ts
@archibald-web-app/frontend/src/hooks/useAutomaticSync.ts
@archibald-web-app/frontend/src/db/schema.ts

**Tech Stack Available:**
- PendingOrdersService with getPendingOrdersWithCounts(), syncPendingOrders()
- useAutomaticSync hook for automatic background sync
- IndexedDB schema v2 with PendingOrder table
- Banking app UX patterns from Phase 8

**Established Patterns:**
- Inline styles (consistent with OfflineBanner, OrderCard)
- Banking app aesthetic (Intesa/UniCredit reference)
- Status badges with semantic colors (blue/green/yellow/red)
- Loading states with spinner and progress feedback

**Constraining Decisions:**
- Phase 8: Automatic sync on reconnect already works
- Phase 8: PendingOrder stores complete API-compliant data
- Phase 8: Banking app UX with yellow banner for offline mode
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PendingOrdersView component with queue display</name>
  <files>archibald-web-app/frontend/src/pages/PendingOrdersView.tsx</files>
  <action>
Create PendingOrdersView page component:
- Use PendingOrdersService.getPendingOrdersWithCounts() to fetch orders
- Display summary stats: total pending (blue badge), syncing (yellow), error (red)
- Show order list grouped by status with temporal grouping (Oggi, Questa settimana, Pi√π vecchi)
- Each order card shows: customer name, items count, total amount, created timestamp, status badge
- Banking app aesthetic: white cards on #f5f5f5 background, 12px border radius, subtle shadows
- Empty state: "üì≠ Nessun ordine in coda" when queue is empty
- Loading state: spinner with "Caricamento coda..." message
- Use inline styles (consistent with Phase 8-06 OfflineBanner pattern)
  </action>
  <verify>Component renders without errors, displays placeholder when no orders</verify>
  <done>PendingOrdersView displays queue list with status badges and banking app UX</done>
</task>

<task type="auto">
  <name>Task 2: Add manual sync button with progress feedback</name>
  <files>archibald-web-app/frontend/src/pages/PendingOrdersView.tsx</files>
  <action>
Add manual sync functionality to PendingOrdersView:
- "Sincronizza Ora" button (blue, prominent, appears only when pending > 0)
- On click: call PendingOrdersService.syncPendingOrders(jwt, onProgress)
- Show progress: "Sincronizzazione in corso... (2/5)" with progress bar
- Success toast: "‚úÖ {N} ordini sincronizzati con successo"
- Error handling: "‚ö†Ô∏è {N} ordini non sincronizzati, riprova pi√π tardi"
- Button disabled during sync (prevent double-trigger)
- Auto-refresh list after sync completes
Use fetch with Authorization header for JWT token from localStorage ('archibald_jwt').
  </action>
  <verify>Manual sync button triggers sync, shows progress, updates list on completion</verify>
  <done>Users can manually sync pending orders with visual progress feedback</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation to PendingOrdersView from AppRouter</name>
  <files>archibald-web-app/frontend/src/AppRouter.tsx</files>
  <action>
Integrate PendingOrdersView into app navigation:
- Import PendingOrdersView component
- Add /pending route to Routes (protected by auth)
- Add navigation link in AppHeader: "üìã Coda" with badge showing pending count
- Badge color: yellow (matches offline banner), shows count from PendingOrdersService
- Badge visible only when count > 0 (fetched on mount and after order creation)
- Active route highlighting (blue underline when on /pending)
Reuse AppHeader pattern from Phase 10-07 (OrderHistory integration).
  </action>
  <verify>Navigate to /pending route, see PendingOrdersView, badge shows correct count</verify>
  <done>PendingOrdersView accessible via navigation with pending count badge</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PendingOrdersView renders without errors
- [ ] Queue list displays with status badges and banking app aesthetic
- [ ] Manual sync button triggers sync with progress feedback
- [ ] Navigation link in AppHeader shows pending count badge
- [ ] Empty state displays when no pending orders
- [ ] TypeScript compilation passes (no new errors)
</verification>

<success_criteria>

- All tasks completed
- PendingOrdersView displays offline queue with status badges
- Manual sync button works with progress feedback
- Navigation integrated with pending count badge
- Banking app UX consistent with Phase 8 patterns
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/09-offline-queue/09-01-SUMMARY.md`:

# Phase 9 Plan 01: Pending Orders UI & Manual Sync Summary

**Created pending orders view with manual sync capability and navigation integration.**

## Accomplishments

- Created PendingOrdersView component with queue display
- Implemented manual sync button with progress feedback
- Integrated navigation with pending count badge
- Banking app UX with status badges and temporal grouping

## Files Created/Modified

- `archibald-web-app/frontend/src/pages/PendingOrdersView.tsx` - New pending orders view
- `archibald-web-app/frontend/src/AppRouter.tsx` - Added /pending route and navigation link

## Decisions Made

[Key decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Plan 09-02 (Conflict Detection for Stale Data)
</output>
