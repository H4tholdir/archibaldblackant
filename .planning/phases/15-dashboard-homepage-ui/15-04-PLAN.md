---
phase: 15-dashboard-homepage-ui
plan: 04
type: execute
---

<objective>
Create Target Visualization Widget with circular progress chart and dynamic motivational messaging.

Purpose: Provide agents with visual goal progress feedback and context-aware motivational messages to drive budget target achievement.
Output: TargetVisualizationWidget component displaying circular progress chart with percentage and adaptive motivational messages based on performance thresholds.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-dashboard-homepage-ui/15-01-SUMMARY.md
@.planning/phases/15-dashboard-homepage-ui/15-02-SUMMARY.md
@.planning/phases/15-dashboard-homepage-ui/15-03-SUMMARY.md

**Key files:**
@archibald-web-app/frontend/src/pages/Dashboard.tsx
@archibald-web-app/frontend/src/components/BudgetWidget.tsx

**Tech stack available:**
- React 19 with hooks
- TypeScript strict mode
- Inline styles (Phase 10-06 decision)
- SVG for circular progress chart

**Established patterns:**
- Phase 10-06: Color-coded indicators (green/yellow/red semantic colors)
- Phase 15-02: Progress thresholds (>=80% green, 50-79% yellow, <50% red)
- Banking app UX patterns (visual progress indicators with motivational context)
- Inline styles with smooth transitions

**Constraining decisions:**
- No external charting libraries (SVG inline pattern for performance)
- Color coding consistent with BudgetWidget (Phase 15-02)
- Motivational messages in Italian (agent-facing UI)
- Mock data for MVP until Phase 17 backend integration

**Current data availability:**
- BudgetWidget provides currentBudget and targetBudget props pattern
- No aggregated monthly target data yet (requires Phase 17)
- Widget will use mock data for MVP, replaced in Phase 17
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TargetVisualizationWidget with SVG circular progress chart</name>
  <files>
    archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx,
    archibald-web-app/frontend/src/pages/Dashboard.tsx
  </files>
  <action>
    Create TargetVisualizationWidget.tsx component with:

    **Props interface:**
    ```typescript
    interface TargetVisualizationWidgetProps {
      currentProgress: number; // 0-100 percentage
      targetDescription: string; // e.g., "Target Mensile"
      periodLabel: string; // e.g., "Gennaio 2026"
    }
    ```

    **Component structure:**
    - Container div with card styling (consistent with BudgetWidget and OrdersSummaryWidget)
    - Header: "Obiettivo" title + periodLabel subtitle
    - Circular progress chart (SVG-based):
      - Outer circle: Background track (light gray)
      - Inner circle: Progress arc (color-coded by threshold)
      - Center: Large percentage text (e.g., "67%") + targetDescription below
    - SVG circle dimensions: 200x200px viewBox, stroke-width 15, radius 85
    - Progress arc calculation: `strokeDasharray` and `strokeDashoffset` for percentage

    **SVG Progress Circle Implementation:**
    ```typescript
    const radius = 85;
    const circumference = 2 * Math.PI * radius; // ~534
    const offset = circumference - (currentProgress / 100) * circumference;

    // SVG structure:
    <svg width="200" height="200" viewBox="0 0 200 200">
      {/* Background track */}
      <circle cx="100" cy="100" r={radius} fill="none" stroke="#e0e0e0" strokeWidth="15" />

      {/* Progress arc */}
      <circle
        cx="100" cy="100" r={radius}
        fill="none"
        stroke={getProgressColor(currentProgress)}
        strokeWidth="15"
        strokeDasharray={circumference}
        strokeDashoffset={offset}
        strokeLinecap="round"
        transform="rotate(-90 100 100)" // Start from top
        style={{ transition: 'stroke-dashoffset 0.5s ease, stroke 0.3s ease' }}
      />

      {/* Center text */}
      <text x="100" y="95" textAnchor="middle" fontSize="48" fontWeight="bold" fill="#2c3e50">
        {currentProgress}%
      </text>
      <text x="100" y="120" textAnchor="middle" fontSize="14" fill="#7f8c8d">
        {targetDescription}
      </text>
    </svg>
    ```

    **Color coding (consistent with BudgetWidget Phase 15-02):**
    ```typescript
    const getProgressColor = (progress: number): string => {
      if (progress >= 80) return '#27ae60'; // Green
      if (progress >= 50) return '#f39c12'; // Yellow
      return '#e74c3c'; // Red
    };
    ```

    **Card styling (inline):**
    - Container: { background: '#f8f9fa', borderRadius: '12px', padding: '25px', textAlign: 'center' }
    - Header: { fontSize: '20px', fontWeight: 'bold', color: '#2c3e50', marginBottom: '10px' }
    - Subtitle: { fontSize: '14px', color: '#7f8c8d', marginBottom: '20px' }
    - SVG centered with margin auto

    Integrate in Dashboard.tsx:
    - Replace third placeholder div with <TargetVisualizationWidget currentProgress={67} targetDescription="Target Mensile" periodLabel="Gennaio 2026" />
    - Temporary mock data until Phase 17 backend integration

    Why SVG over canvas: SVG is declarative (easier to maintain), accessible, responsive, and supports CSS transitions without additional libraries.
  </action>
  <verify>
    npm run typecheck passes

    Manual check:
    1. Dashboard renders TargetVisualizationWidget in third widget section
    2. Widget displays "Obiettivo" title with period label
    3. Circular progress chart visible:
       - Background track (gray) full circle
       - Progress arc (67%) in yellow color (#f39c12)
       - Center text: "67%" large, "Target Mensile" below
    4. Progress arc starts from top (12 o'clock position)
    5. Smooth transition animation on mount
    6. Color matches threshold (67% -> yellow)
    7. No console errors
  </verify>
  <done>
    TargetVisualizationWidget component created with props interface.
    SVG circular progress chart implemented with strokeDasharray/offset calculation.
    Color-coded progress arc (green/yellow/red by threshold).
    Center text displays percentage and target description.
    Smooth CSS transitions on progress changes.
    Widget integrated in Dashboard.tsx with mock data.
    TypeScript compilation passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add dynamic motivational messages based on progress thresholds</name>
  <files>
    archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx
  </files>
  <action>
    Enhance TargetVisualizationWidget with adaptive motivational messaging:

    **Message logic (Italian, agent-facing):**
    ```typescript
    const getMotivationalMessage = (progress: number): { text: string; icon: string } => {
      // Critical zone (<50%)
      if (progress < 30) {
        return {
          text: "Serve una spinta! Puoi recuperare ðŸ’ª",
          icon: "ðŸš¨"
        };
      }
      if (progress < 50) {
        return {
          text: "A metÃ  strada... acceleriamo! ðŸ”¥",
          icon: "âš ï¸"
        };
      }

      // Caution zone (50-79%)
      if (progress < 60) {
        return {
          text: "Buon ritmo, continua cosÃ¬! ðŸ‘",
          icon: "ðŸ“ˆ"
        };
      }
      if (progress < 70) {
        return {
          text: "Ottimo lavoro, ancora un po'! ðŸŽ¯",
          icon: "ðŸ’¼"
        };
      }
      if (progress < 80) {
        return {
          text: "Ci sei quasi, non mollare! ðŸš€",
          icon: "â­"
        };
      }

      // Target zone (>=80%)
      if (progress < 90) {
        return {
          text: "Sei in target! Mantieni il passo ðŸ†",
          icon: "âœ…"
        };
      }
      if (progress < 100) {
        return {
          text: "Eccezionale! Manca pochissimo ðŸŽ‰",
          icon: "ðŸ”¥"
        };
      }

      // Goal reached or exceeded
      return {
        text: "Obiettivo raggiunto! Sei un campione! ðŸ¥‡",
        icon: "ðŸŽŠ"
      };
    };
    ```

    **Message display (below chart):**
    - Message container: { marginTop: '20px', padding: '15px', borderRadius: '8px', backgroundColor: color-coded background (rgba with 0.1 opacity) }
    - Icon: Large emoji left-aligned (fontSize: '32px')
    - Text: Right-aligned with medium weight (fontSize: '16px', fontWeight: '500', color: '#2c3e50')
    - Layout: Flexbox row with space-between

    **Background color by zone:**
    ```typescript
    const getMessageBackground = (progress: number): string => {
      if (progress >= 80) return 'rgba(39, 174, 96, 0.1)'; // Light green
      if (progress >= 50) return 'rgba(243, 156, 18, 0.1)'; // Light yellow
      return 'rgba(231, 76, 60, 0.1)'; // Light red
    };
    ```

    **Styling (inline):**
    - Message container: { display: 'flex', alignItems: 'center', gap: '15px', padding: '15px', borderRadius: '8px', backgroundColor: getMessageBackground(currentProgress), marginTop: '20px' }
    - Icon: { fontSize: '32px' }
    - Text: { fontSize: '16px', fontWeight: '500', color: '#2c3e50', flex: 1 }

    Why granular thresholds: 10 distinct message bands (vs 3 color zones) provide continuous feedback loop, maintaining agent motivation across entire performance spectrum. Psychology research shows frequent positive reinforcement increases goal persistence.
  </action>
  <verify>
    npm run typecheck passes

    Manual check:
    1. Widget displays motivational message below chart
    2. Message matches progress percentage:
       - 67% -> "Ottimo lavoro, ancora un po'! ðŸŽ¯" with ðŸ“ˆ icon
    3. Message background color matches zone (67% -> light yellow)
    4. Message layout: Icon left, text right with proper spacing
    5. Change mock currentProgress prop to test different thresholds:
       - 25% -> "Serve una spinta! Puoi recuperare ðŸ’ª" (red bg)
       - 55% -> "Buon ritmo, continua cosÃ¬! ðŸ‘" (yellow bg)
       - 85% -> "Sei in target! Mantieni il passo ðŸ†" (green bg)
       - 100% -> "Obiettivo raggiunto! Sei un campione! ðŸ¥‡" (green bg)
    6. No console errors
  </verify>
  <done>
    Motivational message function implemented with 10 threshold bands.
    Message display integrated below circular chart.
    Color-coded background (light green/yellow/red) matches progress zone.
    Icon and text layout with proper spacing.
    Messages in Italian for agent-facing UI.
    TypeScript compilation passes.
  </done>
</task>

<task type="checkpoint" checkpoint-type="human-verify">
  <name>Task 3: Checkpoint - Verify complete dashboard with all 4 widgets</name>
  <files>
    archibald-web-app/frontend/src/pages/Dashboard.tsx
  </files>
  <action>
    Human verification of complete dashboard layout with all integrated widgets:

    **What to verify:**
    1. Dashboard page renders at root route (/)
    2. DashboardNav header visible with 8 navigation links
    3. 2-column grid layout on desktop (>=768px)
    4. 1-column stack on mobile (<768px)
    5. Four widgets render correctly:
       - BudgetWidget (first widget, progress bar with color-coded status badge)
       - OrdersSummaryWidget (second widget, 3 clickable cards with colored left borders)
       - TargetVisualizationWidget (third widget, circular chart with motivational message)
       - Fourth widget placeholder or additional content
    6. All widgets have consistent card styling (border-radius, padding, background)
    7. Hover effects work on interactive elements (OrdersSummaryWidget cards)
    8. Responsive behavior: Grid collapses to single column on mobile viewport

    **Test breakpoints:**
    - Mobile (<768px): Single column stack, cards full width
    - Tablet (768-1024px): 2-column grid, cards half width
    - Desktop (>1024px): 2-column grid, max-width 1200px container

    **Visual consistency checklist:**
    - Color palette consistent: Blue (#3498db), Green (#27ae60), Yellow (#f39c12), Red (#e74c3c), Purple (#9b59b6)
    - Typography: Title fonts 18-20px bold, body 14-16px regular, labels 12-14px gray
    - Spacing: 20px container padding, 15-20px gap between grid items, 15-25px card padding
    - Borders: 8-12px border-radius, colored left borders 4px solid on OrdersSummaryWidget

    **Browser console:**
    - Zero TypeScript errors
    - Zero runtime errors
    - No accessibility warnings (check for missing aria-labels)

    Mark checkpoint complete when all visual and functional aspects verified across device sizes.
  </action>
  <verify>
    Human verification checklist:
    - [ ] Dashboard accessible at http://localhost:5173/
    - [ ] DashboardNav renders with all 8 links
    - [ ] 4 widgets visible in grid layout
    - [ ] BudgetWidget shows progress bar with status badge
    - [ ] OrdersSummaryWidget shows 3 cards (Oggi/Settimana/Mese), clickable
    - [ ] TargetVisualizationWidget shows circular chart + motivational message
    - [ ] Responsive: Grid 2-col desktop, 1-col mobile
    - [ ] Hover effects on OrdersSummaryWidget cards
    - [ ] Consistent styling across all widgets
    - [ ] Browser console: No errors or warnings
  </verify>
  <done>
    Human verified complete dashboard layout with 4 widgets.
    All widgets render correctly with consistent styling.
    Responsive layout works across mobile/tablet/desktop breakpoints.
    Interactive elements (hover, click) function as expected.
    No console errors or accessibility warnings.
    Dashboard ready for user acceptance testing.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes in frontend directory
- [ ] TargetVisualizationWidget component created with circular SVG progress chart
- [ ] Color-coded progress arc (green/yellow/red by threshold)
- [ ] Motivational messages display with 10 distinct threshold bands
- [ ] Message background color matches progress zone
- [ ] Widget integrated in Dashboard.tsx
- [ ] Complete dashboard layout verified with all 4 widgets across breakpoints
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- TargetVisualizationWidget displays circular progress chart with smooth transitions
- Motivational messages adapt dynamically to progress percentage
- Complete dashboard homepage functional with navigation + 4 widgets
- Responsive layout works across mobile/tablet/desktop
- Consistent styling and color coding across all dashboard components
- No TypeScript errors or runtime warnings
  </success_criteria>

<output>
After completion, create `.planning/phases/15-dashboard-homepage-ui/15-04-SUMMARY.md`:

# Phase 15 Plan 04: Target Visualization Widget Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `archibald-web-app/frontend/src/components/TargetVisualizationWidget.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 15 complete. Ready for Phase 16.
</output>
